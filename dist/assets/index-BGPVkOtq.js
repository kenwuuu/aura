(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const pt=()=>new Map,Mn=n=>{const t=pt();return n.forEach((e,s)=>{t.set(s,e)}),t},wt=(n,t,e)=>{let s=n.get(t);return s===void 0&&n.set(t,s=e()),s},hi=(n,t)=>{const e=[];for(const[s,i]of n)e.push(t(i,s));return e},ui=(n,t)=>{for(const[e,s]of n)if(t(s,e))return!0;return!1},Kt=()=>new Set,vn=n=>n[n.length-1],fi=(n,t)=>{for(let e=0;e<t.length;e++)n.push(t[e])},jt=Array.from,di=Array.isArray;class Hr{constructor(){this._observers=pt()}on(t,e){return wt(this._observers,t,Kt).add(e),e}once(t,e){const s=(...i)=>{this.off(t,s),e(...i)};this.on(t,s)}off(t,e){const s=this._observers.get(t);s!==void 0&&(s.delete(e),s.size===0&&this._observers.delete(t))}emit(t,e){return jt((this._observers.get(t)||pt()).values()).forEach(s=>s(...e))}destroy(){this._observers=pt()}}class Yr{constructor(){this._observers=pt()}on(t,e){wt(this._observers,t,Kt).add(e)}once(t,e){const s=(...i)=>{this.off(t,s),e(...i)};this.on(t,s)}off(t,e){const s=this._observers.get(t);s!==void 0&&(s.delete(e),s.size===0&&this._observers.delete(t))}emit(t,e){return jt((this._observers.get(t)||pt()).values()).forEach(s=>s(...e))}destroy(){this._observers=pt()}}const It=Math.floor,Ke=Math.abs,gi=Math.log10,Yn=(n,t)=>n<t?n:t,le=(n,t)=>n>t?n:t,$r=n=>n!==0?n<0:1/n<0,yr=1,mr=2,Cn=4,Sn=8,xe=32,Ft=64,mt=128,fn=31,Nn=63,ee=127,pi=2147483647,zr=Number.MAX_SAFE_INTEGER,yi=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&It(n)===n),mi=String.fromCharCode,wi=n=>n.toLowerCase(),bi=/^\s*/g,_i=n=>n.replace(bi,""),vi=/([A-Z])/g,wr=(n,t)=>_i(n.replace(vi,e=>`${t}${wi(e)}`)),Ci=n=>{const t=unescape(encodeURIComponent(n)),e=t.length,s=new Uint8Array(e);for(let i=0;i<e;i++)s[i]=t.codePointAt(i);return s},Me=typeof TextEncoder<"u"?new TextEncoder:null,Si=n=>Me.encode(n),Un=Me?Si:Ci;let Le=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Le&&Le.decode(new Uint8Array).length===1&&(Le=null);class Ve{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ct=()=>new Ve,Ei=n=>{let t=n.cpos;for(let e=0;e<n.bufs.length;e++)t+=n.bufs[e].length;return t},et=n=>{const t=new Uint8Array(Ei(n));let e=0;for(let s=0;s<n.bufs.length;s++){const i=n.bufs[s];t.set(i,e),e+=i.length}return t.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),e),t},ki=(n,t)=>{const e=n.cbuf.length;e-n.cpos<t&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(le(e,t)*2),n.cpos=0)},at=(n,t)=>{const e=n.cbuf.length;n.cpos===e&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(e*2),n.cpos=0),n.cbuf[n.cpos++]=t},Ne=at,q=(n,t)=>{for(;t>ee;)at(n,mt|ee&t),t=It(t/128);at(n,ee&t)},$n=(n,t)=>{const e=$r(t);for(e&&(t=-t),at(n,(t>Nn?mt:0)|(e?Ft:0)|Nn&t),t=It(t/64);t>0;)at(n,(t>ee?mt:0)|ee&t),t=It(t/128)},Fn=new Uint8Array(3e4),Ri=Fn.length/3,Ti=(n,t)=>{if(t.length<Ri){const e=Me.encodeInto(t,Fn).written||0;q(n,e);for(let s=0;s<e;s++)at(n,Fn[s])}else rt(n,Un(t))},Ai=(n,t)=>{const e=unescape(encodeURIComponent(t)),s=e.length;q(n,s);for(let i=0;i<s;i++)at(n,e.codePointAt(i))},At=Me&&Me.encodeInto?Ti:Ai,dn=(n,t)=>{const e=n.cbuf.length,s=n.cpos,i=Yn(e-s,t.length),o=t.length-i;n.cbuf.set(t.subarray(0,i),s),n.cpos+=i,o>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(le(e*2,o)),n.cbuf.set(t.subarray(i)),n.cpos=o)},rt=(n,t)=>{q(n,t.byteLength),dn(n,t)},zn=(n,t)=>{ki(n,t);const e=new DataView(n.cbuf.buffer,n.cpos,t);return n.cpos+=t,e},Di=(n,t)=>zn(n,4).setFloat32(0,t,!1),Ii=(n,t)=>zn(n,8).setFloat64(0,t,!1),Li=(n,t)=>zn(n,8).setBigInt64(0,t,!1),br=new DataView(new ArrayBuffer(4)),Oi=n=>(br.setFloat32(0,n),br.getFloat32(0)===n),we=(n,t)=>{switch(typeof t){case"string":at(n,119),At(n,t);break;case"number":yi(t)&&Ke(t)<=pi?(at(n,125),$n(n,t)):Oi(t)?(at(n,124),Di(n,t)):(at(n,123),Ii(n,t));break;case"bigint":at(n,122),Li(n,t);break;case"object":if(t===null)at(n,126);else if(di(t)){at(n,117),q(n,t.length);for(let e=0;e<t.length;e++)we(n,t[e])}else if(t instanceof Uint8Array)at(n,116),rt(n,t);else{at(n,118);const e=Object.keys(t);q(n,e.length);for(let s=0;s<e.length;s++){const i=e[s];At(n,i),we(n,t[i])}}break;case"boolean":at(n,t?120:121);break;default:at(n,127)}};class _r extends Ve{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&q(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const vr=n=>{n.count>0&&($n(n.encoder,n.count===1?n.s:-n.s),n.count>1&&q(n.encoder,n.count-2))};class Xe{constructor(){this.encoder=new Ve,this.s=0,this.count=0}write(t){this.s===t?this.count++:(vr(this),this.count=1,this.s=t)}toUint8Array(){return vr(this),et(this.encoder)}}const Cr=n=>{if(n.count>0){const t=n.diff*2+(n.count===1?0:1);$n(n.encoder,t),n.count>1&&q(n.encoder,n.count-2)}};class En{constructor(){this.encoder=new Ve,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Cr(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Cr(this),et(this.encoder)}}class xi{constructor(){this.sarr=[],this.s="",this.lensE=new Xe}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Ve;return this.sarr.push(this.s),this.s="",At(t,this.sarr.join("")),dn(t,this.lensE.toUint8Array()),et(t)}}const Lt=n=>new Error(n),Dt=()=>{throw Lt("Method unimplemented")},Ot=()=>{throw Lt("Unexpected case")},Gr=Lt("Unexpected end of array"),Jr=Lt("Integer out of Range");class gn{constructor(t){this.arr=t,this.pos=0}}const Nt=n=>new gn(n),Mi=n=>n.pos!==n.arr.length,Ni=(n,t)=>{const e=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,t);return n.pos+=t,e},lt=n=>Ni(n,Y(n)),re=n=>n.arr[n.pos++],Y=n=>{let t=0,e=1;const s=n.arr.length;for(;n.pos<s;){const i=n.arr[n.pos++];if(t=t+(i&ee)*e,e*=128,i<mt)return t;if(t>zr)throw Jr}throw Gr},Gn=n=>{let t=n.arr[n.pos++],e=t&Nn,s=64;const i=(t&Ft)>0?-1:1;if(!(t&mt))return i*e;const o=n.arr.length;for(;n.pos<o;){if(t=n.arr[n.pos++],e=e+(t&ee)*s,s*=128,t<mt)return i*e;if(e>zr)throw Jr}throw Gr},Ui=n=>{let t=Y(n);if(t===0)return"";{let e=String.fromCodePoint(re(n));if(--t<100)for(;t--;)e+=String.fromCodePoint(re(n));else for(;t>0;){const s=t<1e4?t:1e4,i=n.arr.subarray(n.pos,n.pos+s);n.pos+=s,e+=String.fromCodePoint.apply(null,i),t-=s}return decodeURIComponent(escape(e))}},Fi=n=>Le.decode(lt(n)),Bt=Le?Fi:Ui,Jn=(n,t)=>{const e=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,t);return n.pos+=t,e},Bi=n=>Jn(n,4).getFloat32(0,!1),ji=n=>Jn(n,8).getFloat64(0,!1),Pi=n=>Jn(n,8).getBigInt64(0,!1),Vi=[n=>{},n=>null,Gn,Bi,ji,Pi,n=>!1,n=>!0,Bt,n=>{const t=Y(n),e={};for(let s=0;s<t;s++){const i=Bt(n);e[i]=be(n)}return e},n=>{const t=Y(n),e=[];for(let s=0;s<t;s++)e.push(be(n));return e},lt],be=n=>Vi[127-re(n)](n);class Sr extends gn{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Mi(this)?this.count=Y(this)+1:this.count=-1),this.count--,this.s}}class Ze extends gn{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Gn(this);const t=$r(this.s);this.count=1,t&&(this.s=-this.s,this.count=Y(this)+2)}return this.count--,this.s}}class kn extends gn{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Gn(this),e=t&1;this.diff=It(t/2),this.count=1,e&&(this.count=Y(this)+2)}return this.s+=this.diff,this.count--,this.s}}class qi{constructor(t){this.decoder=new Ze(t),this.str=Bt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}const Wi=crypto.getRandomValues.bind(crypto),Hi=Math.random,Kr=()=>Wi(new Uint32Array(1))[0],Yi="10000000-1000-4000-8000"+-1e11,Xr=()=>Yi.replace(/[018]/g,n=>(n^Kr()&15>>n/4).toString(16)),Pt=Date.now,Er=n=>new Promise(n);Promise.all.bind(Promise);const $i=n=>Promise.reject(n),Kn=n=>Promise.resolve(n),kr=n=>n===void 0?null:n;class zi{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Zr=new zi,Xn=!0;try{typeof localStorage<"u"&&localStorage&&(Zr=localStorage,Xn=!1)}catch{}const Qr=Zr,Gi=n=>Xn||addEventListener("storage",n),Ji=n=>Xn||removeEventListener("storage",n),Ki=Object.assign,ts=Object.keys,Xi=(n,t)=>{for(const e in n)t(n[e],e)},Rr=n=>ts(n).length,Tr=n=>ts(n).length,Zi=n=>{for(const t in n)return!1;return!0},Qi=(n,t)=>{for(const e in n)if(!t(n[e],e))return!1;return!0},es=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),to=(n,t)=>n===t||Tr(n)===Tr(t)&&Qi(n,(e,s)=>(e!==void 0||es(t,s))&&t[s]===e),eo=Object.freeze,ns=n=>{for(const t in n){const e=n[t];(typeof e=="object"||typeof e=="function")&&ns(n[t])}return eo(n)},Ar=Symbol("Equality"),Zn=(n,t,e=0)=>{try{for(;e<n.length;e++)n[e](...t)}finally{e<n.length&&Zn(n,t,e+1)}},no=()=>{},ro=n=>n,Oe=(n,t)=>{if(n===t)return!0;if(n==null||t==null||n.constructor!==t.constructor)return!1;if(n[Ar]!=null)return n[Ar](t);switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),t=new Uint8Array(t);case Uint8Array:{if(n.byteLength!==t.byteLength)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;break}case Set:{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;break}case Map:{if(n.size!==t.size)return!1;for(const e of n.keys())if(!t.has(e)||!Oe(n.get(e),t.get(e)))return!1;break}case Object:if(Rr(n)!==Rr(t))return!1;for(const e in n)if(!es(n,e)||!Oe(n[e],t[e]))return!1;break;case Array:if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(!Oe(n[e],t[e]))return!1;break;default:return!1}return!0},so=(n,t)=>t.includes(n);var rs={};const _e=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",ss=typeof window<"u"&&typeof document<"u"&&!_e;let Rt;const io=()=>{if(Rt===void 0)if(_e){Rt=pt();const n=process.argv;let t=null;for(let e=0;e<n.length;e++){const s=n[e];s[0]==="-"?(t!==null&&Rt.set(t,""),t=s):t!==null&&(Rt.set(t,s),t=null)}t!==null&&Rt.set(t,"")}else typeof location=="object"?(Rt=pt(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[t,e]=n.split("=");Rt.set(`--${wr(t,"-")}`,e),Rt.set(`-${wr(t,"-")}`,e)}})):Rt=pt();return Rt},Bn=n=>io().has(n),Ue=n=>kr(_e?rs[n.toUpperCase().replaceAll("-","_")]:Qr.getItem(n)),is=n=>Bn("--"+n)||Ue(n)!==null;is("production");const oo=_e&&so(rs.FORCE_COLOR,["true","1","2"]),ao=oo||!Bn("--no-colors")&&!is("no-color")&&(!_e||process.stdout.isTTY)&&(!_e||Bn("--color")||Ue("COLORTERM")!==null||(Ue("TERM")||"").includes("color")),os=n=>new Uint8Array(n),lo=(n,t,e)=>new Uint8Array(n,t,e),co=n=>new Uint8Array(n),ho=n=>{let t="";for(let e=0;e<n.byteLength;e++)t+=mi(n[e]);return btoa(t)},uo=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),fo=n=>{const t=atob(n),e=os(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e},go=n=>{const t=Buffer.from(n,"base64");return lo(t.buffer,t.byteOffset,t.byteLength)},as=ss?ho:uo,ls=ss?fo:go,po=n=>{const t=os(n.byteLength);return t.set(n),t};class yo{constructor(t,e){this.left=t,this.right=e}}const Ut=(n,t)=>new yo(n,t);typeof DOMParser<"u"&&new DOMParser;const mo=n=>hi(n,(t,e)=>`${e}:${t};`).join(""),wo=JSON.stringify,Vt=Symbol,vt=Vt(),se=Vt(),cs=Vt(),Qn=Vt(),hs=Vt(),us=Vt(),fs=Vt(),pn=Vt(),yn=Vt(),bo=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const t=[],e=[];let s=0;for(;s<n.length;s++){const o=n[s];if(o===void 0)break;if(o.constructor===String||o.constructor===Number)t.push(o);else if(o.constructor===Object)break}for(s>0&&e.push(t.join(""));s<n.length;s++){const o=n[s];o instanceof Symbol||e.push(o)}return e},Dr=[hs,fs,pn,cs];let Rn=0,Ir=Pt();const _o=(n,t)=>{const e=Dr[Rn],s=Ue("log"),i=s!==null&&(s==="*"||s==="true"||new RegExp(s,"gi").test(t));return Rn=(Rn+1)%Dr.length,t+=": ",i?(...o)=>{var l;o.length===1&&((l=o[0])==null?void 0:l.constructor)===Function&&(o=o[0]());const h=Pt(),c=h-Ir;Ir=h,n(e,t,yn,...o.map(p=>{switch(p!=null&&p.constructor===Uint8Array&&(p=Array.from(p)),typeof p){case"string":case"symbol":return p;default:return wo(p)}}),e," +"+c+"ms")}:no},vo={[vt]:Ut("font-weight","bold"),[se]:Ut("font-weight","normal"),[cs]:Ut("color","blue"),[hs]:Ut("color","green"),[Qn]:Ut("color","grey"),[us]:Ut("color","red"),[fs]:Ut("color","purple"),[pn]:Ut("color","orange"),[yn]:Ut("color","black")},Co=n=>{var h;n.length===1&&((h=n[0])==null?void 0:h.constructor)===Function&&(n=n[0]());const t=[],e=[],s=pt();let i=[],o=0;for(;o<n.length;o++){const c=n[o],l=vo[c];if(l!==void 0)s.set(l.left,l.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){const p=mo(s);o>0||p.length>0?(t.push("%c"+c),e.push(p)):t.push(c)}else break}}for(o>0&&(i=e,i.unshift(t.join("")));o<n.length;o++){const c=n[o];c instanceof Symbol||i.push(c)}return i},ds=ao?Co:bo,gs=(...n)=>{console.log(...ds(n)),ps.forEach(t=>t.print(n))},So=(...n)=>{console.warn(...ds(n)),n.unshift(pn),ps.forEach(t=>t.print(n))},ps=Kt(),Eo=n=>_o(gs,n),ys=n=>({[Symbol.iterator](){return this},next:n}),ko=(n,t)=>ys(()=>{let e;do e=n.next();while(!e.done&&!t(e.value));return e}),Tn=(n,t)=>ys(()=>{const{done:e,value:s}=n.next();return{done:e,value:e?void 0:t(s)}});class tr{constructor(t,e){this.clock=t,this.len=e}}class qe{constructor(){this.clients=new Map}}const ms=(n,t,e)=>t.clients.forEach((s,i)=>{const o=n.doc.store.clients.get(i);if(o!=null){const h=o[o.length-1],c=h.id.clock+h.length;for(let l=0,p=s[l];l<s.length&&p.clock<c;p=s[++l])Is(n,o,p.clock,p.len,e)}}),Ro=(n,t)=>{let e=0,s=n.length-1;for(;e<=s;){const i=It((e+s)/2),o=n[i],h=o.clock;if(h<=t){if(t<h+o.len)return i;e=i+1}else s=i-1}return null},ws=(n,t)=>{const e=n.clients.get(t.client);return e!==void 0&&Ro(e,t.clock)!==null},er=n=>{n.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let e,s;for(e=1,s=1;e<t.length;e++){const i=t[s-1],o=t[e];i.clock+i.len>=o.clock?i.len=le(i.len,o.clock+o.len-i.clock):(s<e&&(t[s]=o),s++)}t.length=s})},To=n=>{const t=new qe;for(let e=0;e<n.length;e++)n[e].clients.forEach((s,i)=>{if(!t.clients.has(i)){const o=s.slice();for(let h=e+1;h<n.length;h++)fi(o,n[h].clients.get(i)||[]);t.clients.set(i,o)}});return er(t),t},tn=(n,t,e,s)=>{wt(n.clients,t,()=>[]).push(new tr(e,s))},Ao=()=>new qe,Do=n=>{const t=Ao();return n.clients.forEach((e,s)=>{const i=[];for(let o=0;o<e.length;o++){const h=e[o];if(h.deleted){const c=h.id.clock;let l=h.length;if(o+1<e.length)for(let p=e[o+1];o+1<e.length&&p.deleted;p=e[++o+1])l+=p.length;i.push(new tr(c,l))}}i.length>0&&t.clients.set(s,i)}),t},ke=(n,t)=>{q(n.restEncoder,t.clients.size),jt(t.clients.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{n.resetDsCurVal(),q(n.restEncoder,e);const i=s.length;q(n.restEncoder,i);for(let o=0;o<i;o++){const h=s[o];n.writeDsClock(h.clock),n.writeDsLen(h.len)}})},nr=n=>{const t=new qe,e=Y(n.restDecoder);for(let s=0;s<e;s++){n.resetDsCurVal();const i=Y(n.restDecoder),o=Y(n.restDecoder);if(o>0){const h=wt(t.clients,i,()=>[]);for(let c=0;c<o;c++)h.push(new tr(n.readDsClock(),n.readDsLen()))}}return t},Lr=(n,t,e)=>{const s=new qe,i=Y(n.restDecoder);for(let o=0;o<i;o++){n.resetDsCurVal();const h=Y(n.restDecoder),c=Y(n.restDecoder),l=e.clients.get(h)||[],p=ht(e,h);for(let b=0;b<c;b++){const u=n.readDsClock(),d=u+n.readDsLen();if(u<p){p<d&&tn(s,h,p,d-p);let y=xt(l,u),g=l[y];for(!g.deleted&&g.id.clock<u&&(l.splice(y+1,0,ln(t,g,u-g.id.clock)),y++);y<l.length&&(g=l[y++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&l.splice(y,0,ln(t,g,d-g.id.clock)),g.delete(t))}else tn(s,h,u,d-u)}}if(s.clients.size>0){const o=new ie;return q(o.restEncoder,0),ke(o,s),o.toUint8Array()}return null},bs=Kr;class Re extends Hr{constructor({guid:t=Xr(),collectionid:e=null,gc:s=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:h=!1,shouldLoad:c=!0}={}){super(),this.gc=s,this.gcFilter=i,this.clientID=bs(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new As,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=h,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Er(p=>{this.on("load",()=>{this.isLoaded=!0,p(this)})});const l=()=>Er(p=>{const b=u=>{(u===void 0||u===!0)&&(this.off("sync",b),p())};this.on("sync",b)});this.on("sync",p=>{p===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=p===void 0||p===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Q(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(jt(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Q(this,t,e)}get(t,e=ft){const s=wt(this.share,t,()=>{const o=new e;return o._integrate(this,null),o}),i=s.constructor;if(e!==ft&&i!==e)if(i===ft){const o=new e;o._map=s._map,s._map.forEach(h=>{for(;h!==null;h=h.left)h.parent=o}),o._start=s._start;for(let h=o._start;h!==null;h=h.right)h.parent=o;return o._length=s._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return s}getArray(t=""){return this.get(t,ye)}getText(t=""){return this.get(t,Se)}getMap(t=""){return this.get(t,Ce)}getXmlElement(t=""){return this.get(t,Ee)}getXmlFragment(t=""){return this.get(t,oe)}toJSON(){const t={};return this.share.forEach((e,s)=>{t[s]=e.toJSON()}),t}destroy(){this.isDestroyed=!0,jt(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new Re({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Q(t.parent.doc,s=>{const i=e.doc;t.deleted||s.subdocsAdded.add(i),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class _s{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Y(this.restDecoder)}readDsLen(){return Y(this.restDecoder)}}class vs extends _s{readLeftID(){return K(Y(this.restDecoder),Y(this.restDecoder))}readRightID(){return K(Y(this.restDecoder),Y(this.restDecoder))}readClient(){return Y(this.restDecoder)}readInfo(){return re(this.restDecoder)}readString(){return Bt(this.restDecoder)}readParentInfo(){return Y(this.restDecoder)===1}readTypeRef(){return Y(this.restDecoder)}readLen(){return Y(this.restDecoder)}readAny(){return be(this.restDecoder)}readBuf(){return po(lt(this.restDecoder))}readJSON(){return JSON.parse(Bt(this.restDecoder))}readKey(){return Bt(this.restDecoder)}}class Io{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Y(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Y(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ve extends Io{constructor(t){super(t),this.keys=[],Y(t),this.keyClockDecoder=new kn(lt(t)),this.clientDecoder=new Ze(lt(t)),this.leftClockDecoder=new kn(lt(t)),this.rightClockDecoder=new kn(lt(t)),this.infoDecoder=new Sr(lt(t),re),this.stringDecoder=new qi(lt(t)),this.parentInfoDecoder=new Sr(lt(t),re),this.typeRefDecoder=new Ze(lt(t)),this.lenDecoder=new Ze(lt(t))}readLeftID(){return new pe(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new pe(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return be(this.restDecoder)}readBuf(){return lt(this.restDecoder)}readJSON(){return be(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Cs{constructor(){this.restEncoder=ct()}toUint8Array(){return et(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){q(this.restEncoder,t)}writeDsLen(t){q(this.restEncoder,t)}}class We extends Cs{writeLeftID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeRightID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeClient(t){q(this.restEncoder,t)}writeInfo(t){Ne(this.restEncoder,t)}writeString(t){At(this.restEncoder,t)}writeParentInfo(t){q(this.restEncoder,t?1:0)}writeTypeRef(t){q(this.restEncoder,t)}writeLen(t){q(this.restEncoder,t)}writeAny(t){we(this.restEncoder,t)}writeBuf(t){rt(this.restEncoder,t)}writeJSON(t){At(this.restEncoder,JSON.stringify(t))}writeKey(t){At(this.restEncoder,t)}}class Ss{constructor(){this.restEncoder=ct(),this.dsCurrVal=0}toUint8Array(){return et(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,q(this.restEncoder,e)}writeDsLen(t){t===0&&Ot(),q(this.restEncoder,t-1),this.dsCurrVal+=t}}class ie extends Ss{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new En,this.clientEncoder=new Xe,this.leftClockEncoder=new En,this.rightClockEncoder=new En,this.infoEncoder=new _r(Ne),this.stringEncoder=new xi,this.parentInfoEncoder=new _r(Ne),this.typeRefEncoder=new Xe,this.lenEncoder=new Xe}toUint8Array(){const t=ct();return q(t,0),rt(t,this.keyClockEncoder.toUint8Array()),rt(t,this.clientEncoder.toUint8Array()),rt(t,this.leftClockEncoder.toUint8Array()),rt(t,this.rightClockEncoder.toUint8Array()),rt(t,et(this.infoEncoder)),rt(t,this.stringEncoder.toUint8Array()),rt(t,et(this.parentInfoEncoder)),rt(t,this.typeRefEncoder.toUint8Array()),rt(t,this.lenEncoder.toUint8Array()),dn(t,et(this.restEncoder)),et(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){we(this.restEncoder,t)}writeBuf(t){rt(this.restEncoder,t)}writeJSON(t){we(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Lo=(n,t,e,s)=>{s=le(s,t[0].id.clock);const i=xt(t,s);q(n.restEncoder,t.length-i),n.writeClient(e),q(n.restEncoder,s);const o=t[i];o.write(n,s-o.id.clock);for(let h=i+1;h<t.length;h++)t[h].write(n,0)},rr=(n,t,e)=>{const s=new Map;e.forEach((i,o)=>{ht(t,o)>i&&s.set(o,i)}),mn(t).forEach((i,o)=>{e.has(o)||s.set(o,0)}),q(n.restEncoder,s.size),jt(s.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{Lo(n,t.clients.get(i),i,o)})},Oo=(n,t)=>{const e=pt(),s=Y(n.restDecoder);for(let i=0;i<s;i++){const o=Y(n.restDecoder),h=new Array(o),c=n.readClient();let l=Y(n.restDecoder);e.set(c,{i:0,refs:h});for(let p=0;p<o;p++){const b=n.readInfo();switch(fn&b){case 0:{const u=n.readLen();h[p]=new bt(K(c,l),u),l+=u;break}case 10:{const u=Y(n.restDecoder);h[p]=new _t(K(c,l),u),l+=u;break}default:{const u=(b&(Ft|mt))===0,d=new it(K(c,l),null,(b&mt)===mt?n.readLeftID():null,null,(b&Ft)===Ft?n.readRightID():null,u?n.readParentInfo()?t.get(n.readString()):n.readLeftID():null,u&&(b&xe)===xe?n.readString():null,Js(n,b));h[p]=d,l+=d.length}}}}return e},xo=(n,t,e)=>{const s=[];let i=jt(e.keys()).sort((y,g)=>y-g);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let y=e.get(i[i.length-1]);for(;y.refs.length===y.i;)if(i.pop(),i.length>0)y=e.get(i[i.length-1]);else return null;return y};let h=o();if(h===null)return null;const c=new As,l=new Map,p=(y,g)=>{const C=l.get(y);(C==null||C>g)&&l.set(y,g)};let b=h.refs[h.i++];const u=new Map,d=()=>{for(const y of s){const g=y.id.client,C=e.get(g);C?(C.i--,c.clients.set(g,C.refs.slice(C.i)),e.delete(g),C.i=0,C.refs=[]):c.clients.set(g,[y]),i=i.filter(M=>M!==g)}s.length=0};for(;;){if(b.constructor!==_t){const g=wt(u,b.id.client,()=>ht(t,b.id.client))-b.id.clock;if(g<0)s.push(b),p(b.id.client,b.id.clock-1),d();else{const C=b.getMissing(n,t);if(C!==null){s.push(b);const M=e.get(C)||{refs:[],i:0};if(M.refs.length===M.i)p(C,ht(t,C)),d();else{b=M.refs[M.i++];continue}}else(g===0||g<b.length)&&(b.integrate(n,g),u.set(b.id.client,b.id.clock+b.length))}}if(s.length>0)b=s.pop();else if(h!==null&&h.i<h.refs.length)b=h.refs[h.i++];else{if(h=o(),h===null)break;b=h.refs[h.i++]}}if(c.clients.size>0){const y=new ie;return rr(y,c,new Map),q(y.restEncoder,0),{missing:l,update:y.toUint8Array()}}return null},Mo=(n,t)=>rr(n,t.doc.store,t.beforeState),No=(n,t,e,s=new ve(n))=>Q(t,i=>{i.local=!1;let o=!1;const h=i.doc,c=h.store,l=Oo(s,h),p=xo(i,c,l),b=c.pendingStructs;if(b){for(const[d,y]of b.missing)if(y<ht(c,d)){o=!0;break}if(p){for(const[d,y]of p.missing){const g=b.missing.get(d);(g==null||g>y)&&b.missing.set(d,y)}b.update=en([b.update,p.update])}}else c.pendingStructs=p;const u=Lr(s,i,c);if(c.pendingDs){const d=new ve(Nt(c.pendingDs));Y(d.restDecoder);const y=Lr(d,i,c);u&&y?c.pendingDs=en([u,y]):c.pendingDs=u||y}else c.pendingDs=u;if(o){const d=c.pendingStructs.update;c.pendingStructs=null,Es(i.doc,d)}},e,!1),Es=(n,t,e,s=ve)=>{const i=Nt(t);No(i,n,e,new s(i))},Uo=(n,t,e)=>Es(n,t,e,vs),Fo=(n,t,e=new Map)=>{rr(n,t.store,e),ke(n,Do(t.store))},Bo=(n,t=new Uint8Array([0]),e=new ie)=>{const s=ks(t);Fo(e,n,s);const i=[e.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(ta(n.store.pendingStructs.update,t)),i.length>1){if(e.constructor===We)return Zo(i.map((o,h)=>h===0?o:na(o)));if(e.constructor===ie)return en(i)}return i[0]},jo=(n,t)=>Bo(n,t,new We),Po=n=>{const t=new Map,e=Y(n.restDecoder);for(let s=0;s<e;s++){const i=Y(n.restDecoder),o=Y(n.restDecoder);t.set(i,o)}return t},ks=n=>Po(new _s(Nt(n))),Rs=(n,t)=>(q(n.restEncoder,t.size),jt(t.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{q(n.restEncoder,e),q(n.restEncoder,s)}),n),Vo=(n,t)=>Rs(n,mn(t.store)),qo=(n,t=new Ss)=>(n instanceof Map?Rs(t,n):Vo(t,n),t.toUint8Array()),Wo=n=>qo(n,new Cs);class Ho{constructor(){this.l=[]}}const Or=()=>new Ho,xr=(n,t)=>n.l.push(t),Mr=(n,t)=>{const e=n.l,s=e.length;n.l=e.filter(i=>t!==i),s===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ts=(n,t,e)=>Zn(n.l,[t,e]);class pe{constructor(t,e){this.client=t,this.clock=e}}const $e=(n,t)=>n===t||n!==null&&t!==null&&n.client===t.client&&n.clock===t.clock,K=(n,t)=>new pe(n,t),Yo=n=>{for(const[t,e]of n.doc.share.entries())if(e===n)return t;throw Ot()},ge=(n,t)=>t===void 0?!n.deleted:t.sv.has(n.id.client)&&(t.sv.get(n.id.client)||0)>n.id.clock&&!ws(t.ds,n.id),jn=(n,t)=>{const e=wt(n.meta,jn,Kt),s=n.doc.store;e.has(t)||(t.sv.forEach((i,o)=>{i<ht(s,o)&&Xt(n,K(o,i))}),ms(n,t.ds,i=>{}),e.add(t))};class As{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const mn=n=>{const t=new Map;return n.clients.forEach((e,s)=>{const i=e[e.length-1];t.set(s,i.id.clock+i.length)}),t},ht=(n,t)=>{const e=n.clients.get(t);if(e===void 0)return 0;const s=e[e.length-1];return s.id.clock+s.length},Ds=(n,t)=>{let e=n.clients.get(t.id.client);if(e===void 0)e=[],n.clients.set(t.id.client,e);else{const s=e[e.length-1];if(s.id.clock+s.length!==t.id.clock)throw Ot()}e.push(t)},xt=(n,t)=>{let e=0,s=n.length-1,i=n[s],o=i.id.clock;if(o===t)return s;let h=It(t/(o+i.length-1)*s);for(;e<=s;){if(i=n[h],o=i.id.clock,o<=t){if(t<o+i.length)return h;e=h+1}else s=h-1;h=It((e+s)/2)}throw Ot()},$o=(n,t)=>{const e=n.clients.get(t.client);return e[xt(e,t.clock)]},An=$o,Pn=(n,t,e)=>{const s=xt(t,e),i=t[s];return i.id.clock<e&&i instanceof it?(t.splice(s+1,0,ln(n,i,e-i.id.clock)),s+1):s},Xt=(n,t)=>{const e=n.doc.store.clients.get(t.client);return e[Pn(n,e,t.clock)]},Nr=(n,t,e)=>{const s=t.clients.get(e.client),i=xt(s,e.clock),o=s[i];return e.clock!==o.id.clock+o.length-1&&o.constructor!==bt&&s.splice(i+1,0,ln(n,o,e.clock-o.id.clock+1)),o},zo=(n,t,e)=>{const s=n.clients.get(t.id.client);s[xt(s,t.id.clock)]=e},Is=(n,t,e,s,i)=>{if(s===0)return;const o=e+s;let h=Pn(n,t,e),c;do c=t[h++],o<c.id.clock+c.length&&Pn(n,t,o),i(c);while(h<t.length&&t[h].id.clock<o)};class Go{constructor(t,e,s){this.doc=t,this.deleteSet=new qe,this.beforeState=mn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ur=(n,t)=>t.deleteSet.clients.size===0&&!ui(t.afterState,(e,s)=>t.beforeState.get(s)!==e)?!1:(er(t.deleteSet),Mo(n,t),ke(n,t.deleteSet),!0),Fr=(n,t,e)=>{const s=t._item;(s===null||s.id.clock<(n.beforeState.get(s.id.client)||0)&&!s.deleted)&&wt(n.changed,t,Kt).add(e)},Qe=(n,t)=>{let e=n[t],s=n[t-1],i=t;for(;i>0;e=s,s=n[--i-1]){if(s.deleted===e.deleted&&s.constructor===e.constructor&&s.mergeWith(e)){e instanceof it&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,s);continue}break}const o=t-i;return o&&n.splice(t+1-o,o),o},Jo=(n,t,e)=>{for(const[s,i]of n.clients.entries()){const o=t.clients.get(s);for(let h=i.length-1;h>=0;h--){const c=i[h],l=c.clock+c.len;for(let p=xt(o,c.clock),b=o[p];p<o.length&&b.id.clock<l;b=o[++p]){const u=o[p];if(c.clock+c.len<=u.id.clock)break;u instanceof it&&u.deleted&&!u.keep&&e(u)&&u.gc(t,!1)}}}},Ko=(n,t)=>{n.clients.forEach((e,s)=>{const i=t.clients.get(s);for(let o=e.length-1;o>=0;o--){const h=e[o],c=Yn(i.length-1,1+xt(i,h.clock+h.len-1));for(let l=c,p=i[l];l>0&&p.id.clock>=h.clock;p=i[l])l-=1+Qe(i,l)}})},Ls=(n,t)=>{if(t<n.length){const e=n[t],s=e.doc,i=s.store,o=e.deleteSet,h=e._mergeStructs;try{er(o),e.afterState=mn(e.doc.store),s.emit("beforeObserverCalls",[e,s]);const c=[];e.changed.forEach((l,p)=>c.push(()=>{(p._item===null||!p._item.deleted)&&p._callObserver(e,l)})),c.push(()=>{e.changedParentTypes.forEach((l,p)=>{p._dEH.l.length>0&&(p._item===null||!p._item.deleted)&&(l=l.filter(b=>b.target._item===null||!b.target._item.deleted),l.forEach(b=>{b.currentTarget=p,b._path=null}),l.sort((b,u)=>b.path.length-u.path.length),Ts(p._dEH,l,e))})}),c.push(()=>s.emit("afterTransaction",[e,s])),Zn(c,[]),e._needFormattingCleanup&&ya(e)}finally{s.gc&&Jo(o,i,s.gcFilter),Ko(o,i),e.afterState.forEach((b,u)=>{const d=e.beforeState.get(u)||0;if(d!==b){const y=i.clients.get(u),g=le(xt(y,d),1);for(let C=y.length-1;C>=g;)C-=1+Qe(y,C)}});for(let b=h.length-1;b>=0;b--){const{client:u,clock:d}=h[b].id,y=i.clients.get(u),g=xt(y,d);g+1<y.length&&Qe(y,g+1)>1||g>0&&Qe(y,g)}if(!e.local&&e.afterState.get(s.clientID)!==e.beforeState.get(s.clientID)&&(gs(pn,vt,"[yjs] ",se,us,"Changed the client-id because another client seems to be using it."),s.clientID=bs()),s.emit("afterTransactionCleanup",[e,s]),s._observers.has("update")){const b=new We;Ur(b,e)&&s.emit("update",[b.toUint8Array(),e.origin,s,e])}if(s._observers.has("updateV2")){const b=new ie;Ur(b,e)&&s.emit("updateV2",[b.toUint8Array(),e.origin,s,e])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:p}=e;(c.size>0||p.size>0||l.size>0)&&(c.forEach(b=>{b.clientID=s.clientID,b.collectionid==null&&(b.collectionid=s.collectionid),s.subdocs.add(b)}),p.forEach(b=>s.subdocs.delete(b)),s.emit("subdocs",[{loaded:l,added:c,removed:p},s,e]),p.forEach(b=>b.destroy())),n.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,n])):Ls(n,t+1)}}},Q=(n,t,e=null,s=!0)=>{const i=n._transactionCleanups;let o=!1,h=null;n._transaction===null&&(o=!0,n._transaction=new Go(n,e,s),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{h=t(n._transaction)}finally{if(o){const c=n._transaction===i[0];n._transaction=null,c&&Ls(i,0)}}return h};function*Xo(n){const t=Y(n.restDecoder);for(let e=0;e<t;e++){const s=Y(n.restDecoder),i=n.readClient();let o=Y(n.restDecoder);for(let h=0;h<s;h++){const c=n.readInfo();if(c===10){const l=Y(n.restDecoder);yield new _t(K(i,o),l),o+=l}else if(fn&c){const l=(c&(Ft|mt))===0,p=new it(K(i,o),null,(c&mt)===mt?n.readLeftID():null,null,(c&Ft)===Ft?n.readRightID():null,l?n.readParentInfo()?n.readString():n.readLeftID():null,l&&(c&xe)===xe?n.readString():null,Js(n,c));yield p,o+=p.length}else{const l=n.readLen();yield new bt(K(i,o),l),o+=l}}}}class sr{constructor(t,e){this.gen=Xo(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===_t);return this.curr}}class ir{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Zo=n=>en(n,vs,We),Qo=(n,t)=>{if(n.constructor===bt){const{client:e,clock:s}=n.id;return new bt(K(e,s+t),n.length-t)}else if(n.constructor===_t){const{client:e,clock:s}=n.id;return new _t(K(e,s+t),n.length-t)}else{const e=n,{client:s,clock:i}=e.id;return new it(K(s,i+t),null,K(s,i+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},en=(n,t=ve,e=ie)=>{if(n.length===1)return n[0];const s=n.map(b=>new t(Nt(b)));let i=s.map(b=>new sr(b,!0)),o=null;const h=new e,c=new ir(h);for(;i=i.filter(d=>d.curr!==null),i.sort((d,y)=>{if(d.curr.id.client===y.curr.id.client){const g=d.curr.id.clock-y.curr.id.clock;return g===0?d.curr.constructor===y.curr.constructor?0:d.curr.constructor===_t?1:-1:g}else return y.curr.id.client-d.curr.id.client}),i.length!==0;){const b=i[0],u=b.curr.id.client;if(o!==null){let d=b.curr,y=!1;for(;d!==null&&d.id.clock+d.length<=o.struct.id.clock+o.struct.length&&d.id.client>=o.struct.id.client;)d=b.next(),y=!0;if(d===null||d.id.client!==u||y&&d.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)Gt(c,o.struct,o.offset),o={struct:d,offset:0},b.next();else if(o.struct.id.clock+o.struct.length<d.id.clock)if(o.struct.constructor===_t)o.struct.length=d.id.clock+d.length-o.struct.id.clock;else{Gt(c,o.struct,o.offset);const g=d.id.clock-o.struct.id.clock-o.struct.length;o={struct:new _t(K(u,o.struct.id.clock+o.struct.length),g),offset:0}}else{const g=o.struct.id.clock+o.struct.length-d.id.clock;g>0&&(o.struct.constructor===_t?o.struct.length-=g:d=Qo(d,g)),o.struct.mergeWith(d)||(Gt(c,o.struct,o.offset),o={struct:d,offset:0},b.next())}}else o={struct:b.curr,offset:0},b.next();for(let d=b.curr;d!==null&&d.id.client===u&&d.id.clock===o.struct.id.clock+o.struct.length&&d.constructor!==_t;d=b.next())Gt(c,o.struct,o.offset),o={struct:d,offset:0}}o!==null&&(Gt(c,o.struct,o.offset),o=null),or(c);const l=s.map(b=>nr(b)),p=To(l);return ke(h,p),h.toUint8Array()},ta=(n,t,e=ve,s=ie)=>{const i=ks(t),o=new s,h=new ir(o),c=new e(Nt(n)),l=new sr(c,!1);for(;l.curr;){const b=l.curr,u=b.id.client,d=i.get(u)||0;if(l.curr.constructor===_t){l.next();continue}if(b.id.clock+b.length>d)for(Gt(h,b,le(d-b.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Gt(h,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}or(h);const p=nr(c);return ke(o,p),o.toUint8Array()},Os=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:et(n.encoder.restEncoder)}),n.encoder.restEncoder=ct(),n.written=0)},Gt=(n,t,e)=>{n.written>0&&n.currClient!==t.id.client&&Os(n),n.written===0&&(n.currClient=t.id.client,n.encoder.writeClient(t.id.client),q(n.encoder.restEncoder,t.id.clock+e)),t.write(n.encoder,e),n.written++},or=n=>{Os(n);const t=n.encoder.restEncoder;q(t,n.clientStructs.length);for(let e=0;e<n.clientStructs.length;e++){const s=n.clientStructs[e];q(t,s.written),dn(t,s.restEncoder)}},ea=(n,t,e,s)=>{const i=new e(Nt(n)),o=new sr(i,!1),h=new s,c=new ir(h);for(let p=o.curr;p!==null;p=o.next())Gt(c,t(p),0);or(c);const l=nr(i);return ke(h,l),h.toUint8Array()},na=n=>ea(n,ro,ve,We),Br="You must not compute changes after the event-handler fired.";class wn{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ra(this.currentTarget,this.target))}deletes(t){return ws(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lt(Br);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const o=e._map.get(i);let h,c;if(this.adds(o)){let l=o.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(o))if(l!==null&&this.deletes(l))h="delete",c=vn(l.content.getContent());else return;else l!==null&&this.deletes(l)?(h="update",c=vn(l.content.getContent())):(h="add",c=void 0)}else if(this.deletes(o))h="delete",c=vn(o.content.getContent());else return;t.set(i,{action:h,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lt(Br);const e=this.target,s=Kt(),i=Kt(),o=[];if(t={added:s,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(e).has(null)){let c=null;const l=()=>{c&&o.push(c)};for(let p=e._start;p!==null;p=p.right)p.deleted?this.deletes(p)&&!this.adds(p)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=p.length,i.add(p)):this.adds(p)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(p.content.getContent()),s.add(p)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=p.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const ra=(n,t)=>{const e=[];for(;t._item!==null&&t!==n;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let s=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(s+=i.length),i=i.right;e.unshift(s)}t=t._item.parent}return e},dt=()=>{So("Invalid access: Add Yjs type to a document before reading data.")},xs=80;let ar=0;class sa{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=ar++}}const ia=n=>{n.timestamp=ar++},Ms=(n,t,e)=>{n.p.marker=!1,n.p=t,t.marker=!0,n.index=e,n.timestamp=ar++},oa=(n,t,e)=>{if(n.length>=xs){const s=n.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return Ms(s,t,e),s}else{const s=new sa(t,e);return n.push(s),s}},bn=(n,t)=>{if(n._start===null||t===0||n._searchMarker===null)return null;const e=n._searchMarker.length===0?null:n._searchMarker.reduce((o,h)=>Ke(t-o.index)<Ke(t-h.index)?o:h);let s=n._start,i=0;for(e!==null&&(s=e.p,i=e.index,ia(e));s.right!==null&&i<t;){if(!s.deleted&&s.countable){if(t<i+s.length)break;i+=s.length}s=s.right}for(;s.left!==null&&i>t;)s=s.left,!s.deleted&&s.countable&&(i-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(i-=s.length);return e!==null&&Ke(e.index-i)<s.parent.length/xs?(Ms(e,s,i),e):oa(n._searchMarker,s,i)},Fe=(n,t,e)=>{for(let s=n.length-1;s>=0;s--){const i=n[s];if(e>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){n.splice(s,1);continue}i.p=o,o.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=le(t,i.index+e))}},_n=(n,t,e)=>{const s=n,i=t.changedParentTypes;for(;wt(i,n,()=>[]).push(e),n._item!==null;)n=n._item.parent;Ts(s._eH,e,t)};class ft{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Or(),this._dEH=Or(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw Dt()}clone(){throw Dt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){xr(this._eH,t)}observeDeep(t){xr(this._dEH,t)}unobserve(t){Mr(this._eH,t)}unobserveDeep(t){Mr(this._dEH,t)}toJSON(){}}const Ns=(n,t,e)=>{n.doc??dt(),t<0&&(t=n._length+t),e<0&&(e=n._length+e);let s=e-t;const i=[];let o=n._start;for(;o!==null&&s>0;){if(o.countable&&!o.deleted){const h=o.content.getContent();if(h.length<=t)t-=h.length;else{for(let c=t;c<h.length&&s>0;c++)i.push(h[c]),s--;t=0}}o=o.right}return i},Us=n=>{n.doc??dt();const t=[];let e=n._start;for(;e!==null;){if(e.countable&&!e.deleted){const s=e.content.getContent();for(let i=0;i<s.length;i++)t.push(s[i])}e=e.right}return t},Be=(n,t)=>{let e=0,s=n._start;for(n.doc??dt();s!==null;){if(s.countable&&!s.deleted){const i=s.content.getContent();for(let o=0;o<i.length;o++)t(i[o],e++,n)}s=s.right}},Fs=(n,t)=>{const e=[];return Be(n,(s,i)=>{e.push(t(s,i,n))}),e},aa=n=>{let t=n._start,e=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),s=0,t=t.right}const i=e[s++];return e.length<=s&&(e=null),{done:!1,value:i}}}},Bs=(n,t)=>{n.doc??dt();const e=bn(n,t);let s=n._start;for(e!==null&&(s=e.p,t-=e.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},nn=(n,t,e,s)=>{let i=e;const o=n.doc,h=o.clientID,c=o.store,l=e===null?t._start:e.right;let p=[];const b=()=>{p.length>0&&(i=new it(K(h,ht(c,h)),i,i&&i.lastId,l,l&&l.id,t,null,new ae(p)),i.integrate(n,0),p=[])};s.forEach(u=>{if(u===null)p.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:p.push(u);break;default:switch(b(),u.constructor){case Uint8Array:case ArrayBuffer:i=new it(K(h,ht(c,h)),i,i&&i.lastId,l,l&&l.id,t,null,new He(new Uint8Array(u))),i.integrate(n,0);break;case Re:i=new it(K(h,ht(c,h)),i,i&&i.lastId,l,l&&l.id,t,null,new Ye(u)),i.integrate(n,0);break;default:if(u instanceof ft)i=new it(K(h,ht(c,h)),i,i&&i.lastId,l,l&&l.id,t,null,new qt(u)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),b()},js=()=>Lt("Length exceeded!"),Ps=(n,t,e,s)=>{if(e>t._length)throw js();if(e===0)return t._searchMarker&&Fe(t._searchMarker,e,s.length),nn(n,t,null,s);const i=e,o=bn(t,e);let h=t._start;for(o!==null&&(h=o.p,e-=o.index,e===0&&(h=h.prev,e+=h&&h.countable&&!h.deleted?h.length:0));h!==null;h=h.right)if(!h.deleted&&h.countable){if(e<=h.length){e<h.length&&Xt(n,K(h.id.client,h.id.clock+e));break}e-=h.length}return t._searchMarker&&Fe(t._searchMarker,i,s.length),nn(n,t,h,s)},la=(n,t,e)=>{let i=(t._searchMarker||[]).reduce((o,h)=>h.index>o.index?h:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return nn(n,t,i,e)},Vs=(n,t,e,s)=>{if(s===0)return;const i=e,o=s,h=bn(t,e);let c=t._start;for(h!==null&&(c=h.p,e-=h.index);c!==null&&e>0;c=c.right)!c.deleted&&c.countable&&(e<c.length&&Xt(n,K(c.id.client,c.id.clock+e)),e-=c.length);for(;s>0&&c!==null;)c.deleted||(s<c.length&&Xt(n,K(c.id.client,c.id.clock+s)),c.delete(n),s-=c.length),c=c.right;if(s>0)throw js();t._searchMarker&&Fe(t._searchMarker,i,-o+s)},rn=(n,t,e)=>{const s=t._map.get(e);s!==void 0&&s.delete(n)},lr=(n,t,e,s)=>{const i=t._map.get(e)||null,o=n.doc,h=o.clientID;let c;if(s==null)c=new ae([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new ae([s]);break;case Uint8Array:c=new He(s);break;case Re:c=new Ye(s);break;default:if(s instanceof ft)c=new qt(s);else throw new Error("Unexpected content type")}new it(K(h,ht(o.store,h)),i,i&&i.lastId,null,null,t,e,c).integrate(n,0)},cr=(n,t)=>{n.doc??dt();const e=n._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},qs=n=>{const t={};return n.doc??dt(),n._map.forEach((e,s)=>{e.deleted||(t[s]=e.content.getContent()[e.length-1])}),t},Ws=(n,t)=>{n.doc??dt();const e=n._map.get(t);return e!==void 0&&!e.deleted},ca=(n,t)=>{const e={};return n._map.forEach((s,i)=>{let o=s;for(;o!==null&&(!t.sv.has(o.id.client)||o.id.clock>=(t.sv.get(o.id.client)||0));)o=o.left;o!==null&&ge(o,t)&&(e[i]=o.content.getContent()[o.length-1])}),e},ze=n=>(n.doc??dt(),ko(n._map.entries(),t=>!t[1].deleted));class ha extends wn{}class ye extends ft{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new ye;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ye}clone(){const t=new ye;return t.insert(0,this.toArray().map(e=>e instanceof ft?e.clone():e)),t}get length(){return this.doc??dt(),this._length}_callObserver(t,e){super._callObserver(t,e),_n(this,t,new ha(this,t))}insert(t,e){this.doc!==null?Q(this.doc,s=>{Ps(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?Q(this.doc,e=>{la(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?Q(this.doc,s=>{Vs(s,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Bs(this,t)}toArray(){return Us(this)}slice(t=0,e=this.length){return Ns(this,t,e)}toJSON(){return this.map(t=>t instanceof ft?t.toJSON():t)}map(t){return Fs(this,t)}forEach(t){Be(this,t)}[Symbol.iterator](){return aa(this)}_write(t){t.writeTypeRef(Na)}}const ua=n=>new ye;class fa extends wn{constructor(t,e,s){super(t,e),this.keysChanged=s}}class Ce extends ft{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((s,i)=>{this.set(i,s)}),this._prelimContent=null}_copy(){return new Ce}clone(){const t=new Ce;return this.forEach((e,s)=>{t.set(s,e instanceof ft?e.clone():e)}),t}_callObserver(t,e){_n(this,t,new fa(this,t,e))}toJSON(){this.doc??dt();const t={};return this._map.forEach((e,s)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[s]=i instanceof ft?i.toJSON():i}}),t}get size(){return[...ze(this)].length}keys(){return Tn(ze(this),t=>t[0])}values(){return Tn(ze(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Tn(ze(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??dt(),this._map.forEach((e,s)=>{e.deleted||t(e.content.getContent()[e.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Q(this.doc,e=>{rn(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?Q(this.doc,s=>{lr(s,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return cr(this,t)}has(t){return Ws(this,t)}clear(){this.doc!==null?Q(this.doc,t=>{this.forEach(function(e,s,i){rn(t,i,s)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ua)}}const da=n=>new Ce,Jt=(n,t)=>n===t||typeof n=="object"&&typeof t=="object"&&n&&t&&to(n,t);class Vn{constructor(t,e,s,i){this.left=t,this.right=e,this.index=s,this.currentAttributes=i}forward(){switch(this.right===null&&Ot(),this.right.content.constructor){case ot:this.right.deleted||Te(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const jr=(n,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case ot:t.right.deleted||Te(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&Xt(n,K(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ge=(n,t,e,s)=>{const i=new Map,o=s?bn(t,e):null;if(o){const h=new Vn(o.p.left,o.p,o.index,i);return jr(n,h,e-o.index)}else{const h=new Vn(null,t._start,0,i);return jr(n,h,e)}},Hs=(n,t,e,s)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===ot&&Jt(s.get(e.right.content.key),e.right.content.value));)e.right.deleted||s.delete(e.right.content.key),e.forward();const i=n.doc,o=i.clientID;s.forEach((h,c)=>{const l=e.left,p=e.right,b=new it(K(o,ht(i.store,o)),l,l&&l.lastId,p,p&&p.id,t,null,new ot(c,h));b.integrate(n,0),e.right=b,e.forward()})},Te=(n,t)=>{const{key:e,value:s}=t;s===null?n.delete(e):n.set(e,s)},Ys=(n,t)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===ot&&Jt(t[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},$s=(n,t,e,s)=>{const i=n.doc,o=i.clientID,h=new Map;for(const c in s){const l=s[c],p=e.currentAttributes.get(c)??null;if(!Jt(p,l)){h.set(c,p);const{left:b,right:u}=e;e.right=new it(K(o,ht(i.store,o)),b,b&&b.lastId,u,u&&u.id,t,null,new ot(c,l)),e.right.integrate(n,0),e.forward()}}return h},Dn=(n,t,e,s,i)=>{e.currentAttributes.forEach((d,y)=>{i[y]===void 0&&(i[y]=null)});const o=n.doc,h=o.clientID;Ys(e,i);const c=$s(n,t,e,i),l=s.constructor===String?new Mt(s):s instanceof ft?new qt(s):new ce(s);let{left:p,right:b,index:u}=e;t._searchMarker&&Fe(t._searchMarker,e.index,l.getLength()),b=new it(K(h,ht(o.store,h)),p,p&&p.lastId,b,b&&b.id,t,null,l),b.integrate(n,0),e.right=b,e.index=u,e.forward(),Hs(n,t,e,c)},Pr=(n,t,e,s,i)=>{const o=n.doc,h=o.clientID;Ys(e,i);const c=$s(n,t,e,i);t:for(;e.right!==null&&(s>0||c.size>0&&(e.right.deleted||e.right.content.constructor===ot));){if(!e.right.deleted)switch(e.right.content.constructor){case ot:{const{key:l,value:p}=e.right.content,b=i[l];if(b!==void 0){if(Jt(b,p))c.delete(l);else{if(s===0)break t;c.set(l,p)}e.right.delete(n)}else e.currentAttributes.set(l,p);break}default:s<e.right.length&&Xt(n,K(e.right.id.client,e.right.id.clock+s)),s-=e.right.length;break}e.forward()}if(s>0){let l="";for(;s>0;s--)l+=`
`;e.right=new it(K(h,ht(o.store,h)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new Mt(l)),e.right.integrate(n,0),e.forward()}Hs(n,t,e,c)},zs=(n,t,e,s,i)=>{let o=t;const h=pt();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===ot){const p=o.content;h.set(p.key,p)}o=o.right}let c=0,l=!1;for(;t!==o;){if(e===t&&(l=!0),!t.deleted){const p=t.content;switch(p.constructor){case ot:{const{key:b,value:u}=p,d=s.get(b)??null;(h.get(b)!==p||d===u)&&(t.delete(n),c++,!l&&(i.get(b)??null)===u&&d!==u&&(d===null?i.delete(b):i.set(b,d))),!l&&!t.deleted&&Te(i,p);break}}}t=t.right}return c},ga=(n,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ot){const s=t.content.key;e.has(s)?t.delete(n):e.add(s)}t=t.left}},pa=n=>{let t=0;return Q(n.doc,e=>{let s=n._start,i=n._start,o=pt();const h=Mn(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case ot:Te(h,i.content);break;default:t+=zs(e,s,i,o,h),o=Mn(h),s=i;break}i=i.right}}),t},ya=n=>{const t=new Set,e=n.doc;for(const[s,i]of n.afterState.entries()){const o=n.beforeState.get(s)||0;i!==o&&Is(n,e.store.clients.get(s),o,i,h=>{!h.deleted&&h.content.constructor===ot&&h.constructor!==bt&&t.add(h.parent)})}Q(e,s=>{ms(n,n.deleteSet,i=>{if(i instanceof bt||!i.parent._hasFormatting||t.has(i.parent))return;const o=i.parent;i.content.constructor===ot?t.add(o):ga(s,i)});for(const i of t)pa(i)})},Vr=(n,t,e)=>{const s=e,i=Mn(t.currentAttributes),o=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case qt:case ce:case Mt:e<t.right.length&&Xt(n,K(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(n);break}t.forward()}o&&zs(n,o,t.right,i,t.currentAttributes);const h=(t.left||t.right).parent;return h._searchMarker&&Fe(h._searchMarker,t.index,-s+e),t};class ma extends wn{constructor(t,e,s){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];Q(t,s=>{const i=new Map,o=new Map;let h=this.target._start,c=null;const l={};let p="",b=0,u=0;const d=()=>{if(c!==null){let y=null;switch(c){case"delete":u>0&&(y={delete:u}),u=0;break;case"insert":(typeof p=="object"||p.length>0)&&(y={insert:p},i.size>0&&(y.attributes={},i.forEach((g,C)=>{g!==null&&(y.attributes[C]=g)}))),p="";break;case"retain":b>0&&(y={retain:b},Zi(l)||(y.attributes=Ki({},l))),b=0;break}y&&e.push(y),c=null}};for(;h!==null;){switch(h.content.constructor){case qt:case ce:this.adds(h)?this.deletes(h)||(d(),c="insert",p=h.content.getContent()[0],d()):this.deletes(h)?(c!=="delete"&&(d(),c="delete"),u+=1):h.deleted||(c!=="retain"&&(d(),c="retain"),b+=1);break;case Mt:this.adds(h)?this.deletes(h)||(c!=="insert"&&(d(),c="insert"),p+=h.content.str):this.deletes(h)?(c!=="delete"&&(d(),c="delete"),u+=h.length):h.deleted||(c!=="retain"&&(d(),c="retain"),b+=h.length);break;case ot:{const{key:y,value:g}=h.content;if(this.adds(h)){if(!this.deletes(h)){const C=i.get(y)??null;Jt(C,g)?g!==null&&h.delete(s):(c==="retain"&&d(),Jt(g,o.get(y)??null)?delete l[y]:l[y]=g)}}else if(this.deletes(h)){o.set(y,g);const C=i.get(y)??null;Jt(C,g)||(c==="retain"&&d(),l[y]=C)}else if(!h.deleted){o.set(y,g);const C=l[y];C!==void 0&&(Jt(C,g)?C!==null&&h.delete(s):(c==="retain"&&d(),g===null?delete l[y]:l[y]=g))}h.deleted||(c==="insert"&&d(),Te(i,h.content));break}}h=h.right}for(d();e.length>0;){const y=e[e.length-1];if(y.retain!==void 0&&y.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Se extends ft{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??dt(),this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new Se}clone(){const t=new Se;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const s=new ma(this,t,e);_n(this,t,s),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??dt();let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===Mt&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?Q(this.doc,s=>{const i=new Vn(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const h=t[o];if(h.insert!==void 0){const c=!e&&typeof h.insert=="string"&&o===t.length-1&&i.right===null&&h.insert.slice(-1)===`
`?h.insert.slice(0,-1):h.insert;(typeof c!="string"||c.length>0)&&Dn(s,this,i,c,h.attributes||{})}else h.retain!==void 0?Pr(s,this,i,h.retain,h.attributes||{}):h.delete!==void 0&&Vr(s,i,h.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,s){this.doc??dt();const i=[],o=new Map,h=this.doc;let c="",l=this._start;function p(){if(c.length>0){const u={};let d=!1;o.forEach((g,C)=>{d=!0,u[C]=g});const y={insert:c};d&&(y.attributes=u),i.push(y),c=""}}const b=()=>{for(;l!==null;){if(ge(l,t)||e!==void 0&&ge(l,e))switch(l.content.constructor){case Mt:{const u=o.get("ychange");t!==void 0&&!ge(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(p(),o.set("ychange",s?s("removed",l.id):{type:"removed"})):e!==void 0&&!ge(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(p(),o.set("ychange",s?s("added",l.id):{type:"added"})):u!==void 0&&(p(),o.delete("ychange")),c+=l.content.str;break}case qt:case ce:{p();const u={insert:l.content.getContent()[0]};if(o.size>0){const d={};u.attributes=d,o.forEach((y,g)=>{d[g]=y})}i.push(u);break}case ot:ge(l,t)&&(p(),Te(o,l.content));break}l=l.right}p()};return t||e?Q(h,u=>{t&&jn(u,t),e&&jn(u,e),b()},"cleanup"):b(),i}insert(t,e,s){if(e.length<=0)return;const i=this.doc;i!==null?Q(i,o=>{const h=Ge(o,this,t,!s);s||(s={},h.currentAttributes.forEach((c,l)=>{s[l]=c})),Dn(o,this,h,e,s)}):this._pending.push(()=>this.insert(t,e,s))}insertEmbed(t,e,s){const i=this.doc;i!==null?Q(i,o=>{const h=Ge(o,this,t,!s);Dn(o,this,h,e,s||{})}):this._pending.push(()=>this.insertEmbed(t,e,s||{}))}delete(t,e){if(e===0)return;const s=this.doc;s!==null?Q(s,i=>{Vr(i,Ge(i,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,s){if(e===0)return;const i=this.doc;i!==null?Q(i,o=>{const h=Ge(o,this,t,!1);h.right!==null&&Pr(o,this,h,e,s)}):this._pending.push(()=>this.format(t,e,s))}removeAttribute(t){this.doc!==null?Q(this.doc,e=>{rn(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?Q(this.doc,s=>{lr(s,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return cr(this,t)}getAttributes(){return qs(this)}_write(t){t.writeTypeRef(Fa)}}const wa=n=>new Se;class In{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??dt()}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Ee||e.constructor===oe)&&e._start!==null)t=e._start;else for(;t!==null;){const s=t.next;if(s!==null){t=s;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class oe extends ft{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new oe}clone(){const t=new oe;return t.insert(0,this.toArray().map(e=>e instanceof ft?e.clone():e)),t}get length(){return this.doc??dt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new In(this,t)}querySelector(t){t=t.toUpperCase();const s=new In(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return s.done?null:s.value}querySelectorAll(t){return t=t.toUpperCase(),jt(new In(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){_n(this,t,new va(this,e,t))}toString(){return Fs(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},s){const i=t.createDocumentFragment();return s!==void 0&&s._createAssociation(i,this),Be(this,o=>{i.insertBefore(o.toDOM(t,e,s),null)}),i}insert(t,e){this.doc!==null?Q(this.doc,s=>{Ps(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)Q(this.doc,s=>{const i=t&&t instanceof ft?t._item:t;nn(s,this,i,e)});else{const s=this._prelimContent,i=t===null?0:s.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw Lt("Reference item not found");s.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?Q(this.doc,s=>{Vs(s,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return Us(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Bs(this,t)}slice(t=0,e=this.length){return Ns(this,t,e)}forEach(t){Be(this,t)}_write(t){t.writeTypeRef(ja)}}const ba=n=>new oe;class Ee extends oe{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((s,i)=>{this.setAttribute(i,s)}),this._prelimAttrs=null}_copy(){return new Ee(this.nodeName)}clone(){const t=new Ee(this.nodeName),e=this.getAttributes();return Xi(e,(s,i)=>{typeof s=="string"&&t.setAttribute(i,s)}),t.insert(0,this.toArray().map(s=>s instanceof ft?s.clone():s)),t}toString(){const t=this.getAttributes(),e=[],s=[];for(const c in t)s.push(c);s.sort();const i=s.length;for(let c=0;c<i;c++){const l=s[c];e.push(l+'="'+t[l]+'"')}const o=this.nodeName.toLocaleLowerCase(),h=e.length>0?" "+e.join(" "):"";return`<${o}${h}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?Q(this.doc,e=>{rn(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?Q(this.doc,s=>{lr(s,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return cr(this,t)}hasAttribute(t){return Ws(this,t)}getAttributes(t){return t?ca(this,t):qs(this)}toDOM(t=document,e={},s){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const h in o){const c=o[h];typeof c=="string"&&i.setAttribute(h,c)}return Be(this,h=>{i.appendChild(h.toDOM(t,e,s))}),s!==void 0&&s._createAssociation(i,this),i}_write(t){t.writeTypeRef(Ba),t.writeKey(this.nodeName)}}const _a=n=>new Ee(n.readKey());class va extends wn{constructor(t,e,s){super(t,s),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class sn extends Ce{constructor(t){super(),this.hookName=t}_copy(){return new sn(this.hookName)}clone(){const t=new sn(this.hookName);return this.forEach((e,s)=>{t.set(s,e)}),t}toDOM(t=document,e={},s){const i=e[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(o,this),o}_write(t){t.writeTypeRef(Pa),t.writeKey(this.hookName)}}const Ca=n=>new sn(n.readKey());class on extends Se{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new on}clone(){const t=new on;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,s){const i=t.createTextNode(this.toString());return s!==void 0&&s._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const e=[];for(const i in t.attributes){const o=[];for(const h in t.attributes[i])o.push({key:h,value:t.attributes[i][h]});o.sort((h,c)=>h.key<c.key?-1:1),e.push({nodeName:i,attrs:o})}e.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let s="";for(let i=0;i<e.length;i++){const o=e[i];s+=`<${o.nodeName}`;for(let h=0;h<o.attrs.length;h++){const c=o.attrs[h];s+=` ${c.key}="${c.value}"`}s+=">"}s+=t.insert;for(let i=e.length-1;i>=0;i--)s+=`</${e[i].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Va)}}const Sa=n=>new on;class hr{constructor(t,e){this.id=t,this.length=e}get deleted(){throw Dt()}mergeWith(t){return!1}write(t,e,s){throw Dt()}integrate(t,e){throw Dt()}}const Ea=0;class bt extends hr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Ds(t.doc.store,this)}write(t,e){t.writeInfo(Ea),t.writeLen(this.length-e)}getMissing(t,e){return null}}class He{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new He(this.content)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const ka=n=>new He(n.readBuf());class je{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new je(this.len)}splice(t){const e=new je(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){tn(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ra=n=>new je(n.readLen()),Gs=(n,t)=>new Re({guid:n,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ye{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ye(Gs(this.doc.guid,this.opts))}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Ta=n=>new Ye(Gs(n.readString(),n.readAny()));class ce{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ce(this.embed)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Aa=n=>new ce(n.readJSON());class ot{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ot(this.key,this.value)}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,e){const s=e.parent;s._searchMarker=null,s._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Da=n=>new ot(n.readKey(),n.readJSON());class an{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new an(this.arr)}splice(t){const e=new an(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let i=e;i<s;i++){const o=this.arr[i];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Ia=n=>{const t=n.readLen(),e=[];for(let s=0;s<t;s++){const i=n.readString();i==="undefined"?e.push(void 0):e.push(JSON.parse(i))}return new an(e)},La=Ue("node_env")==="development";class ae{constructor(t){this.arr=t,La&&ns(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ae(this.arr)}splice(t){const e=new ae(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let i=e;i<s;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}const Oa=n=>{const t=n.readLen(),e=[];for(let s=0;s<t;s++)e.push(n.readAny());return new ae(e)};class Mt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Mt(this.str)}splice(t){const e=new Mt(this.str.slice(t));this.str=this.str.slice(0,t);const s=this.str.charCodeAt(t-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const xa=n=>new Mt(n.readString()),Ma=[ua,da,wa,_a,ba,Ca,Sa],Na=0,Ua=1,Fa=2,Ba=3,ja=4,Pa=5,Va=6;class qt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new qt(this.type._copy())}splice(t){throw Dt()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(s=>{s.deleted?s.id.clock<(t.beforeState.get(s.id.client)||0)&&t._mergeStructs.push(s):s.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(t,!0),s=s.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const qa=n=>new qt(Ma[n.readTypeRef()](n)),ln=(n,t,e)=>{const{client:s,clock:i}=t.id,o=new it(K(s,i+e),t,K(s,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=K(t.redone.client,t.redone.clock+e)),t.right=o,o.right!==null&&(o.right.left=o),n._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=e,o};class it extends hr{constructor(t,e,s,i,o,h,c,l){super(t,l.getLength()),this.origin=s,this.left=e,this.right=i,this.rightOrigin=o,this.parent=h,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?mr:0}set marker(t){(this.info&Sn)>0!==t&&(this.info^=Sn)}get marker(){return(this.info&Sn)>0}get keep(){return(this.info&yr)>0}set keep(t){this.keep!==t&&(this.info^=yr)}get countable(){return(this.info&mr)>0}get deleted(){return(this.info&Cn)>0}set deleted(t){this.deleted!==t&&(this.info^=Cn)}markDeleted(){this.info|=Cn}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ht(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ht(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===pe&&this.id.client!==this.parent.client&&this.parent.clock>=ht(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Nr(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Xt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===bt||this.right&&this.right.constructor===bt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===it?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===it&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===pe){const s=An(e,this.parent);s.constructor===bt?this.parent=null:this.parent=s.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Nr(t,t.doc.store,K(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,i;if(s!==null)i=s.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,h=new Set;for(;i!==null&&i!==this.right;){if(h.add(i),o.add(i),$e(this.origin,i.origin)){if(i.id.client<this.id.client)s=i,o.clear();else if($e(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&h.has(An(t.doc.store,i.origin)))o.has(An(t.doc.store,i.origin))||(s=i,o.clear());else break;i=i.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ds(t.doc.store,this),this.content.integrate(t,this),Fr(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new bt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:K(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&$e(t.origin,this.lastId)&&this.right===t&&$e(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(s=>{s.p===t&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),tn(t.deleteSet,this.id.client,this.id.clock,this.length),Fr(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw Ot();this.content.gc(t),e?zo(t,this,new bt(this.id,this.length)):this.content=new je(this.length)}write(t,e){const s=e>0?K(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,o=this.parentSub,h=this.content.getRef()&fn|(s===null?0:mt)|(i===null?0:Ft)|(o===null?0:xe);if(t.writeInfo(h),s!==null&&t.writeLeftID(s),i!==null&&t.writeRightID(i),s===null&&i===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const p=Yo(c);t.writeParentInfo(!0),t.writeString(p)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===pe?(t.writeParentInfo(!1),t.writeLeftID(c)):Ot();o!==null&&t.writeString(o)}this.content.write(t,e)}}const Js=(n,t)=>Wa[t&fn](n),Wa=[()=>{Ot()},Ra,Ia,ka,xa,Aa,Da,qa,Oa,Ta,()=>{Ot()}],Ha=10;class _t extends hr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){Ot()}write(t,e){t.writeInfo(Ha),q(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Xs="__ $YJS$ __";Ks[Xs]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ks[Xs]=!0;class Ya{constructor(t={}){this.cards=[],this.config={cardWidth:t.cardWidth??63,cardHeight:t.cardHeight??88,initialCardCount:t.initialCardCount??60},this.initializeDeck()}initializeDeck(){for(let t=0;t<this.config.initialCardCount;t++)this.cards.push({id:`card-${t}`,x:100,y:100,rotation:0,isTapped:!1})}getCards(){return[...this.cards]}drawCard(){return this.cards.pop()??null}shuffleDeck(){for(let t=this.cards.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this.cards[t],this.cards[e]]=[this.cards[e],this.cards[t]]}}getCardCount(){return this.cards.length}getConfig(){return{...this.config}}}class $a{constructor(t,e,s={}){this.cards=new Map,this.dragState={cardId:null,offsetX:0,offsetY:0},this.maxZIndex=0,this.container=t,this.config={backgroundColor:s.backgroundColor??"#1a1a1a",width:s.width??window.innerWidth,height:s.height??window.innerHeight},this.yCards=e.getMap("cards"),this.setupContainer(),this.setupYjsSync(),this.attachEventListeners()}setupContainer(){this.container.style.backgroundColor=this.config.backgroundColor,this.container.style.width=`${this.config.width}px`,this.container.style.height=`${this.config.height}px`,this.container.style.position="relative",this.container.style.overflow="hidden"}setupYjsSync(){this.yCards.observe(t=>{t.changes.keys.forEach((e,s)=>{if(e.action==="add"||e.action==="update"){const i=this.yCards.get(s);i&&this.updateCardElement(i)}else e.action==="delete"&&this.removeCardElement(s)})}),this.yCards.forEach(t=>{this.updateCardElement(t)})}addCard(t){const e={...t,zIndex:++this.maxZIndex};this.yCards.set(t.id,e)}updateCardElement(t){this.cards.set(t.id,t);let e=this.container.querySelector(`[data-card-id="${t.id}"]`);e||(e=this.createCardElement(t),this.container.appendChild(e)),this.updateCardPosition(e,t)}createCardElement(t){const e=document.createElement("div");return e.dataset.cardId=t.id,e.className="card",e.style.position="absolute",e.style.width="63px",e.style.height="88px",e.style.backgroundColor="#2d2d2d",e.style.border="2px solid #4a4a4a",e.style.borderRadius="8px",e.style.cursor="grab",e.style.userSelect="none",e.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",e.addEventListener("mousedown",s=>this.onMouseDown(s,t.id)),e}updateCardPosition(t,e){t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,t.style.transform=`rotate(${e.rotation}deg) ${e.isTapped?"rotate(90deg)":""}`,t.style.zIndex=e.zIndex.toString()}removeCardElement(t){this.cards.delete(t);const e=this.container.querySelector(`[data-card-id="${t}"]`);e&&e.remove()}onMouseDown(t,e){t.preventDefault();const s=this.cards.get(e);if(!s)return;this.dragState={cardId:e,offsetX:t.clientX-s.x,offsetY:t.clientY-s.y};const i={...s,zIndex:++this.maxZIndex};this.yCards.set(e,i);const o=this.container.querySelector(`[data-card-id="${e}"]`);o&&(o.style.cursor="grabbing")}onMouseMove(t){if(!this.dragState.cardId)return;const e=this.cards.get(this.dragState.cardId);if(!e)return;const s=t.clientX-this.dragState.offsetX,i=t.clientY-this.dragState.offsetY,o={...e,x:s,y:i};this.yCards.set(this.dragState.cardId,o)}onMouseUp(){if(this.dragState.cardId){const t=this.container.querySelector(`[data-card-id="${this.dragState.cardId}"]`);t&&(t.style.cursor="grab")}this.dragState={cardId:null,offsetX:0,offsetY:0}}attachEventListeners(){document.addEventListener("mousemove",t=>this.onMouseMove(t)),document.addEventListener("mouseup",()=>this.onMouseUp())}tapCard(t){const e=this.cards.get(t);if(!e)return;const s={...e,isTapped:!e.isTapped};this.yCards.set(t,s)}destroy(){this.cards.clear(),this.container.innerHTML=""}}const za=1200,Ga=2500,cn=3e4,qn=n=>{if(n.shouldConnect&&n.ws===null){const t=new WebSocket(n.url),e=n.binaryType;let s=null;e&&(t.binaryType=e),n.ws=t,n.connecting=!0,n.connected=!1,t.onmessage=h=>{n.lastMessageReceived=Pt();const c=h.data,l=typeof c=="string"?JSON.parse(c):c;l&&l.type==="pong"&&(clearTimeout(s),s=setTimeout(o,cn/2)),n.emit("message",[l,n])};const i=h=>{n.ws!==null&&(n.ws=null,n.connecting=!1,n.connected?(n.connected=!1,n.emit("disconnect",[{type:"disconnect",error:h},n])):n.unsuccessfulReconnects++,setTimeout(qn,Yn(gi(n.unsuccessfulReconnects+1)*za,Ga),n)),clearTimeout(s)},o=()=>{n.ws===t&&n.send({type:"ping"})};t.onclose=()=>i(null),t.onerror=h=>i(h),t.onopen=()=>{n.lastMessageReceived=Pt(),n.connecting=!1,n.connected=!0,n.unsuccessfulReconnects=0,n.emit("connect",[{type:"connect"},n]),s=setTimeout(o,cn/2)}}};class Ja extends Yr{constructor(t,{binaryType:e}={}){super(),this.url=t,this.ws=null,this.binaryType=e||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&cn<Pt()-this.lastMessageReceived&&this.ws.close()},cn/2),qn(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&qn(this)}}const Zs=new Map;class Ka{constructor(t){this.room=t,this.onmessage=null,this._onChange=e=>e.key===t&&this.onmessage!==null&&this.onmessage({data:ls(e.newValue||"")}),Gi(this._onChange)}postMessage(t){Qr.setItem(this.room,as(co(t)))}close(){Ji(this._onChange)}}const Xa=typeof BroadcastChannel>"u"?Ka:BroadcastChannel,ur=n=>wt(Zs,n,()=>{const t=Kt(),e=new Xa(n);return e.onmessage=s=>t.forEach(i=>i(s.data,"broadcastchannel")),{bc:e,subs:t}}),Za=(n,t)=>(ur(n).subs.add(t),t),Qa=(n,t)=>{const e=ur(n),s=e.subs.delete(t);return s&&e.subs.size===0&&(e.bc.close(),Zs.delete(n)),s},tl=(n,t,e=null)=>{const s=ur(n);s.bc.postMessage(t),s.subs.forEach(i=>i(t,e))},el=()=>{let n=!0;return(t,e)=>{if(n){n=!1;try{t()}finally{n=!0}}else e!==void 0&&e()}};var Tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Je(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qs={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){var e=Math.floor,s=Math.abs,i=Math.pow;return function(){function o(h,c,l){function p(d,y){if(!c[d]){if(!h[d]){var g=typeof Je=="function"&&Je;if(!y&&g)return g(d,!0);if(b)return b(d,!0);var C=new Error("Cannot find module '"+d+"'");throw C.code="MODULE_NOT_FOUND",C}var M=c[d]={exports:{}};h[d][0].call(M.exports,function(L){var N=h[d][1][L];return p(N||L)},M,M.exports,o,h,c,l)}return c[d].exports}for(var b=typeof Je=="function"&&Je,u=0;u<l.length;u++)p(l[u]);return p}return o}()({1:[function(o,h,c){function l(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var T=_.indexOf("=");T===-1&&(T=v);var E=T===v?0:4-T%4;return[T,E]}function p(_,v,T){return 3*(v+T)/4-T}function b(_){var v,T,E=l(_),I=E[0],U=E[1],k=new M(p(_,I,U)),A=0,F=0<U?I-4:I;for(T=0;T<F;T+=4)v=C[_.charCodeAt(T)]<<18|C[_.charCodeAt(T+1)]<<12|C[_.charCodeAt(T+2)]<<6|C[_.charCodeAt(T+3)],k[A++]=255&v>>16,k[A++]=255&v>>8,k[A++]=255&v;return U===2&&(v=C[_.charCodeAt(T)]<<2|C[_.charCodeAt(T+1)]>>4,k[A++]=255&v),U===1&&(v=C[_.charCodeAt(T)]<<10|C[_.charCodeAt(T+1)]<<4|C[_.charCodeAt(T+2)]>>2,k[A++]=255&v>>8,k[A++]=255&v),k}function u(_){return g[63&_>>18]+g[63&_>>12]+g[63&_>>6]+g[63&_]}function d(_,v,T){for(var E,I=[],U=v;U<T;U+=3)E=(16711680&_[U]<<16)+(65280&_[U+1]<<8)+(255&_[U+2]),I.push(u(E));return I.join("")}function y(_){for(var v,T=_.length,E=T%3,I=[],U=16383,k=0,A=T-E;k<A;k+=U)I.push(d(_,k,k+U>A?A:k+U));return E===1?(v=_[T-1],I.push(g[v>>2]+g[63&v<<4]+"==")):E===2&&(v=(_[T-2]<<8)+_[T-1],I.push(g[v>>10]+g[63&v>>4]+g[63&v<<2]+"=")),I.join("")}c.byteLength=function(_){var v=l(_),T=v[0],E=v[1];return 3*(T+E)/4-E},c.toByteArray=b,c.fromByteArray=y;for(var g=[],C=[],M=typeof Uint8Array>"u"?Array:Uint8Array,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=0,m=L.length;N<m;++N)g[N]=L[N],C[L.charCodeAt(N)]=N;C[45]=62,C[95]=63},{}],2:[function(){},{}],3:[function(o,h,c){(function(){(function(){var l=String.fromCharCode,p=Math.min;function b(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var a=new Uint8Array(r);return a.__proto__=u.prototype,a}function u(r,a,f){if(typeof r=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(r)}return d(r,a,f)}function d(r,a,f){if(typeof r=="string")return M(r,a);if(ArrayBuffer.isView(r))return L(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(D(r,ArrayBuffer)||r&&D(r.buffer,ArrayBuffer))return N(r,a,f);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var S=r.valueOf&&r.valueOf();if(S!=null&&S!==r)return u.from(S,a,f);var R=m(r);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),a,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function y(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function g(r,a,f){return y(r),0>=r||a===void 0?b(r):typeof f=="string"?b(r).fill(a,f):b(r).fill(a)}function C(r){return y(r),b(0>r?0:0|_(r))}function M(r,a){if((typeof a!="string"||a==="")&&(a="utf8"),!u.isEncoding(a))throw new TypeError("Unknown encoding: "+a);var f=0|v(r,a),S=b(f),R=S.write(r,a);return R!==f&&(S=S.slice(0,R)),S}function L(r){for(var a=0>r.length?0:0|_(r.length),f=b(a),S=0;S<a;S+=1)f[S]=255&r[S];return f}function N(r,a,f){if(0>a||r.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<a+(f||0))throw new RangeError('"length" is outside of buffer bounds');var S;return S=a===void 0&&f===void 0?new Uint8Array(r):f===void 0?new Uint8Array(r,a):new Uint8Array(r,a,f),S.__proto__=u.prototype,S}function m(r){if(u.isBuffer(r)){var a=0|_(r.length),f=b(a);return f.length===0||r.copy(f,0,0,a),f}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?L(r.data):void 0:typeof r.length!="number"||O(r.length)?b(0):L(r)}function _(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|r}function v(r,a){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||D(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var f=r.length,S=2<arguments.length&&arguments[2]===!0;if(!S&&f===0)return 0;for(var R=!1;;)switch(a){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return Qt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*f;case"hex":return f>>>1;case"base64":return Et(r).length;default:if(R)return S?-1:Qt(r).length;a=(""+a).toLowerCase(),R=!0}}function T(r,a,f){var S=!1;if((a===void 0||0>a)&&(a=0),a>this.length||((f===void 0||f>this.length)&&(f=this.length),0>=f)||(f>>>=0,a>>>=0,f<=a))return"";for(r||(r="utf8");;)switch(r){case"hex":return Ct(this,a,f);case"utf8":case"utf-8":return st(this,a,f);case"ascii":return W(this,a,f);case"latin1":case"binary":return he(this,a,f);case"base64":return X(this,a,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Wt(this,a,f);default:if(S)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),S=!0}}function E(r,a,f){var S=r[a];r[a]=r[f],r[f]=S}function I(r,a,f,S,R){if(r.length===0)return-1;if(typeof f=="string"?(S=f,f=0):2147483647<f?f=2147483647:-2147483648>f&&(f=-2147483648),f=+f,O(f)&&(f=R?0:r.length-1),0>f&&(f=r.length+f),f>=r.length){if(R)return-1;f=r.length-1}else if(0>f)if(R)f=0;else return-1;if(typeof a=="string"&&(a=u.from(a,S)),u.isBuffer(a))return a.length===0?-1:U(r,a,f,S,R);if(typeof a=="number")return a&=255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(r,a,f):Uint8Array.prototype.lastIndexOf.call(r,a,f):U(r,[a],f,S,R);throw new TypeError("val must be string, number or Buffer")}function U(r,a,f,S,R){function x(ue,Ie){return P===1?ue[Ie]:ue.readUInt16BE(Ie*P)}var P=1,G=r.length,tt=a.length;if(S!==void 0&&(S=(S+"").toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(2>r.length||2>a.length)return-1;P=2,G/=2,tt/=2,f/=2}var J;if(R){var z=-1;for(J=f;J<G;J++)if(x(r,J)!==x(a,z===-1?0:J-z))z!==-1&&(J-=J-z),z=-1;else if(z===-1&&(z=J),J-z+1===tt)return z*P}else for(f+tt>G&&(f=G-tt),J=f;0<=J;J--){for(var ut=!0,te=0;te<tt;te++)if(x(r,J+te)!==x(a,te)){ut=!1;break}if(ut)return J}return-1}function k(r,a,f,S){f=+f||0;var R=r.length-f;S?(S=+S,S>R&&(S=R)):S=R;var x=a.length;S>x/2&&(S=x/2);for(var P,G=0;G<S;++G){if(P=parseInt(a.substr(2*G,2),16),O(P))return G;r[f+G]=P}return G}function A(r,a,f,S){return kt(Qt(a,r.length-f),r,f,S)}function F(r,a,f,S){return kt(De(a),r,f,S)}function j(r,a,f,S){return F(r,a,f,S)}function H(r,a,f,S){return kt(Et(a),r,f,S)}function $(r,a,f,S){return kt($t(a,r.length-f),r,f,S)}function X(r,a,f){return a===0&&f===r.length?B.fromByteArray(r):B.fromByteArray(r.slice(a,f))}function st(r,a,f){f=p(r.length,f);for(var S=[],R=a;R<f;){var x=r[R],P=null,G=239<x?4:223<x?3:191<x?2:1;if(R+G<=f){var tt,J,z,ut;G===1?128>x&&(P=x):G===2?(tt=r[R+1],(192&tt)==128&&(ut=(31&x)<<6|63&tt,127<ut&&(P=ut))):G===3?(tt=r[R+1],J=r[R+2],(192&tt)==128&&(192&J)==128&&(ut=(15&x)<<12|(63&tt)<<6|63&J,2047<ut&&(55296>ut||57343<ut)&&(P=ut))):G===4&&(tt=r[R+1],J=r[R+2],z=r[R+3],(192&tt)==128&&(192&J)==128&&(192&z)==128&&(ut=(15&x)<<18|(63&tt)<<12|(63&J)<<6|63&z,65535<ut&&1114112>ut&&(P=ut)))}P===null?(P=65533,G=1):65535<P&&(P-=65536,S.push(55296|1023&P>>>10),P=56320|1023&P),S.push(P),R+=G}return gt(S)}function gt(r){var a=r.length;if(a<=4096)return l.apply(String,r);for(var f="",S=0;S<a;)f+=l.apply(String,r.slice(S,S+=4096));return f}function W(r,a,f){var S="";f=p(r.length,f);for(var R=a;R<f;++R)S+=l(127&r[R]);return S}function he(r,a,f){var S="";f=p(r.length,f);for(var R=a;R<f;++R)S+=l(r[R]);return S}function Ct(r,a,f){var S=r.length;(!a||0>a)&&(a=0),(!f||0>f||f>S)&&(f=S);for(var R="",x=a;x<f;++x)R+=Zt(r[x]);return R}function Wt(r,a,f){for(var S=r.slice(a,f),R="",x=0;x<S.length;x+=2)R+=l(S[x]+256*S[x+1]);return R}function nt(r,a,f){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+a>f)throw new RangeError("Trying to access beyond buffer length")}function Z(r,a,f,S,R,x){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>R||a<x)throw new RangeError('"value" argument is out of bounds');if(f+S>r.length)throw new RangeError("Index out of range")}function St(r,a,f,S){if(f+S>r.length)throw new RangeError("Index out of range");if(0>f)throw new RangeError("Index out of range")}function Ht(r,a,f,S,R){return a=+a,f>>>=0,R||St(r,a,f,4),V.write(r,a,f,S,23,4),f+4}function Yt(r,a,f,S,R){return a=+a,f>>>=0,R||St(r,a,f,8),V.write(r,a,f,S,52,8),f+8}function Ae(r){if(r=r.split("=")[0],r=r.trim().replace(w,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function Zt(r){return 16>r?"0"+r.toString(16):r.toString(16)}function Qt(r,a){a=a||1/0;for(var f,S=r.length,R=null,x=[],P=0;P<S;++P){if(f=r.charCodeAt(P),55295<f&&57344>f){if(!R){if(56319<f){-1<(a-=3)&&x.push(239,191,189);continue}else if(P+1===S){-1<(a-=3)&&x.push(239,191,189);continue}R=f;continue}if(56320>f){-1<(a-=3)&&x.push(239,191,189),R=f;continue}f=(R-55296<<10|f-56320)+65536}else R&&-1<(a-=3)&&x.push(239,191,189);if(R=null,128>f){if(0>(a-=1))break;x.push(f)}else if(2048>f){if(0>(a-=2))break;x.push(192|f>>6,128|63&f)}else if(65536>f){if(0>(a-=3))break;x.push(224|f>>12,128|63&f>>6,128|63&f)}else if(1114112>f){if(0>(a-=4))break;x.push(240|f>>18,128|63&f>>12,128|63&f>>6,128|63&f)}else throw new Error("Invalid code point")}return x}function De(r){for(var a=[],f=0;f<r.length;++f)a.push(255&r.charCodeAt(f));return a}function $t(r,a){for(var f,S,R,x=[],P=0;P<r.length&&!(0>(a-=2));++P)f=r.charCodeAt(P),S=f>>8,R=f%256,x.push(R),x.push(S);return x}function Et(r){return B.toByteArray(Ae(r))}function kt(r,a,f,S){for(var R=0;R<S&&!(R+f>=a.length||R>=r.length);++R)a[R+f]=r[R];return R}function D(r,a){return r instanceof a||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===a.name}function O(r){return r!==r}var B=o("base64-js"),V=o("ieee754");c.Buffer=u,c.SlowBuffer=function(r){return+r!=r&&(r=0),u.alloc(+r)},c.INSPECT_MAX_BYTES=50,c.kMaxLength=2147483647,u.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),u.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){return u.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){return u.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(r,a,f){return d(r,a,f)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(r,a,f){return g(r,a,f)},u.allocUnsafe=function(r){return C(r)},u.allocUnsafeSlow=function(r){return C(r)},u.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==u.prototype},u.compare=function(r,a){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),D(a,Uint8Array)&&(a=u.from(a,a.offset,a.byteLength)),!u.isBuffer(r)||!u.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===a)return 0;for(var f=r.length,S=a.length,R=0,x=p(f,S);R<x;++R)if(r[R]!==a[R]){f=r[R],S=a[R];break}return f<S?-1:S<f?1:0},u.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(r,a){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return u.alloc(0);var f;if(a===void 0)for(a=0,f=0;f<r.length;++f)a+=r[f].length;var S=u.allocUnsafe(a),R=0;for(f=0;f<r.length;++f){var x=r[f];if(D(x,Uint8Array)&&(x=u.from(x)),!u.isBuffer(x))throw new TypeError('"list" argument must be an Array of Buffers');x.copy(S,R),R+=x.length}return S},u.byteLength=v,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var a=0;a<r;a+=2)E(this,a,a+1);return this},u.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var a=0;a<r;a+=4)E(this,a,a+3),E(this,a+1,a+2);return this},u.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var a=0;a<r;a+=8)E(this,a,a+7),E(this,a+1,a+6),E(this,a+2,a+5),E(this,a+3,a+4);return this},u.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?st(this,0,r):T.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(r){if(!u.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||u.compare(this,r)===0},u.prototype.inspect=function(){var r="",a=c.INSPECT_MAX_BYTES;return r=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(r+=" ... "),"<Buffer "+r+">"},u.prototype.compare=function(r,a,f,S,R){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(a===void 0&&(a=0),f===void 0&&(f=r?r.length:0),S===void 0&&(S=0),R===void 0&&(R=this.length),0>a||f>r.length||0>S||R>this.length)throw new RangeError("out of range index");if(S>=R&&a>=f)return 0;if(S>=R)return-1;if(a>=f)return 1;if(a>>>=0,f>>>=0,S>>>=0,R>>>=0,this===r)return 0;for(var x=R-S,P=f-a,G=p(x,P),tt=this.slice(S,R),J=r.slice(a,f),z=0;z<G;++z)if(tt[z]!==J[z]){x=tt[z],P=J[z];break}return x<P?-1:P<x?1:0},u.prototype.includes=function(r,a,f){return this.indexOf(r,a,f)!==-1},u.prototype.indexOf=function(r,a,f){return I(this,r,a,f,!0)},u.prototype.lastIndexOf=function(r,a,f){return I(this,r,a,f,!1)},u.prototype.write=function(r,a,f,S){if(a===void 0)S="utf8",f=this.length,a=0;else if(f===void 0&&typeof a=="string")S=a,f=this.length,a=0;else if(isFinite(a))a>>>=0,isFinite(f)?(f>>>=0,S===void 0&&(S="utf8")):(S=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-a;if((f===void 0||f>R)&&(f=R),0<r.length&&(0>f||0>a)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");S||(S="utf8");for(var x=!1;;)switch(S){case"hex":return k(this,r,a,f);case"utf8":case"utf-8":return A(this,r,a,f);case"ascii":return F(this,r,a,f);case"latin1":case"binary":return j(this,r,a,f);case"base64":return H(this,r,a,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,r,a,f);default:if(x)throw new TypeError("Unknown encoding: "+S);S=(""+S).toLowerCase(),x=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(r,a){var f=this.length;r=~~r,a=a===void 0?f:~~a,0>r?(r+=f,0>r&&(r=0)):r>f&&(r=f),0>a?(a+=f,0>a&&(a=0)):a>f&&(a=f),a<r&&(a=r);var S=this.subarray(r,a);return S.__proto__=u.prototype,S},u.prototype.readUIntLE=function(r,a,f){r>>>=0,a>>>=0,f||nt(r,a,this.length);for(var S=this[r],R=1,x=0;++x<a&&(R*=256);)S+=this[r+x]*R;return S},u.prototype.readUIntBE=function(r,a,f){r>>>=0,a>>>=0,f||nt(r,a,this.length);for(var S=this[r+--a],R=1;0<a&&(R*=256);)S+=this[r+--a]*R;return S},u.prototype.readUInt8=function(r,a){return r>>>=0,a||nt(r,1,this.length),this[r]},u.prototype.readUInt16LE=function(r,a){return r>>>=0,a||nt(r,2,this.length),this[r]|this[r+1]<<8},u.prototype.readUInt16BE=function(r,a){return r>>>=0,a||nt(r,2,this.length),this[r]<<8|this[r+1]},u.prototype.readUInt32LE=function(r,a){return r>>>=0,a||nt(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},u.prototype.readUInt32BE=function(r,a){return r>>>=0,a||nt(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},u.prototype.readIntLE=function(r,a,f){r>>>=0,a>>>=0,f||nt(r,a,this.length);for(var S=this[r],R=1,x=0;++x<a&&(R*=256);)S+=this[r+x]*R;return R*=128,S>=R&&(S-=i(2,8*a)),S},u.prototype.readIntBE=function(r,a,f){r>>>=0,a>>>=0,f||nt(r,a,this.length);for(var S=a,R=1,x=this[r+--S];0<S&&(R*=256);)x+=this[r+--S]*R;return R*=128,x>=R&&(x-=i(2,8*a)),x},u.prototype.readInt8=function(r,a){return r>>>=0,a||nt(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},u.prototype.readInt16LE=function(r,a){r>>>=0,a||nt(r,2,this.length);var f=this[r]|this[r+1]<<8;return 32768&f?4294901760|f:f},u.prototype.readInt16BE=function(r,a){r>>>=0,a||nt(r,2,this.length);var f=this[r+1]|this[r]<<8;return 32768&f?4294901760|f:f},u.prototype.readInt32LE=function(r,a){return r>>>=0,a||nt(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},u.prototype.readInt32BE=function(r,a){return r>>>=0,a||nt(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},u.prototype.readFloatLE=function(r,a){return r>>>=0,a||nt(r,4,this.length),V.read(this,r,!0,23,4)},u.prototype.readFloatBE=function(r,a){return r>>>=0,a||nt(r,4,this.length),V.read(this,r,!1,23,4)},u.prototype.readDoubleLE=function(r,a){return r>>>=0,a||nt(r,8,this.length),V.read(this,r,!0,52,8)},u.prototype.readDoubleBE=function(r,a){return r>>>=0,a||nt(r,8,this.length),V.read(this,r,!1,52,8)},u.prototype.writeUIntLE=function(r,a,f,S){if(r=+r,a>>>=0,f>>>=0,!S){var R=i(2,8*f)-1;Z(this,r,a,f,R,0)}var x=1,P=0;for(this[a]=255&r;++P<f&&(x*=256);)this[a+P]=255&r/x;return a+f},u.prototype.writeUIntBE=function(r,a,f,S){if(r=+r,a>>>=0,f>>>=0,!S){var R=i(2,8*f)-1;Z(this,r,a,f,R,0)}var x=f-1,P=1;for(this[a+x]=255&r;0<=--x&&(P*=256);)this[a+x]=255&r/P;return a+f},u.prototype.writeUInt8=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,1,255,0),this[a]=255&r,a+1},u.prototype.writeUInt16LE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,2,65535,0),this[a]=255&r,this[a+1]=r>>>8,a+2},u.prototype.writeUInt16BE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,2,65535,0),this[a]=r>>>8,this[a+1]=255&r,a+2},u.prototype.writeUInt32LE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,4,4294967295,0),this[a+3]=r>>>24,this[a+2]=r>>>16,this[a+1]=r>>>8,this[a]=255&r,a+4},u.prototype.writeUInt32BE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,4,4294967295,0),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},u.prototype.writeIntLE=function(r,a,f,S){if(r=+r,a>>>=0,!S){var R=i(2,8*f-1);Z(this,r,a,f,R-1,-R)}var x=0,P=1,G=0;for(this[a]=255&r;++x<f&&(P*=256);)0>r&&G===0&&this[a+x-1]!==0&&(G=1),this[a+x]=255&(r/P>>0)-G;return a+f},u.prototype.writeIntBE=function(r,a,f,S){if(r=+r,a>>>=0,!S){var R=i(2,8*f-1);Z(this,r,a,f,R-1,-R)}var x=f-1,P=1,G=0;for(this[a+x]=255&r;0<=--x&&(P*=256);)0>r&&G===0&&this[a+x+1]!==0&&(G=1),this[a+x]=255&(r/P>>0)-G;return a+f},u.prototype.writeInt8=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,1,127,-128),0>r&&(r=255+r+1),this[a]=255&r,a+1},u.prototype.writeInt16LE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,2,32767,-32768),this[a]=255&r,this[a+1]=r>>>8,a+2},u.prototype.writeInt16BE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,2,32767,-32768),this[a]=r>>>8,this[a+1]=255&r,a+2},u.prototype.writeInt32LE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,4,2147483647,-2147483648),this[a]=255&r,this[a+1]=r>>>8,this[a+2]=r>>>16,this[a+3]=r>>>24,a+4},u.prototype.writeInt32BE=function(r,a,f){return r=+r,a>>>=0,f||Z(this,r,a,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},u.prototype.writeFloatLE=function(r,a,f){return Ht(this,r,a,!0,f)},u.prototype.writeFloatBE=function(r,a,f){return Ht(this,r,a,!1,f)},u.prototype.writeDoubleLE=function(r,a,f){return Yt(this,r,a,!0,f)},u.prototype.writeDoubleBE=function(r,a,f){return Yt(this,r,a,!1,f)},u.prototype.copy=function(r,a,f,S){if(!u.isBuffer(r))throw new TypeError("argument should be a Buffer");if(f||(f=0),S||S===0||(S=this.length),a>=r.length&&(a=r.length),a||(a=0),0<S&&S<f&&(S=f),S===f||r.length===0||this.length===0)return 0;if(0>a)throw new RangeError("targetStart out of bounds");if(0>f||f>=this.length)throw new RangeError("Index out of range");if(0>S)throw new RangeError("sourceEnd out of bounds");S>this.length&&(S=this.length),r.length-a<S-f&&(S=r.length-a+f);var R=S-f;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(a,f,S);else if(this===r&&f<a&&a<S)for(var x=R-1;0<=x;--x)r[x+a]=this[x+f];else Uint8Array.prototype.set.call(r,this.subarray(f,S),a);return R},u.prototype.fill=function(r,a,f,S){if(typeof r=="string"){if(typeof a=="string"?(S=a,a=0,f=this.length):typeof f=="string"&&(S=f,f=this.length),S!==void 0&&typeof S!="string")throw new TypeError("encoding must be a string");if(typeof S=="string"&&!u.isEncoding(S))throw new TypeError("Unknown encoding: "+S);if(r.length===1){var R=r.charCodeAt(0);(S==="utf8"&&128>R||S==="latin1")&&(r=R)}}else typeof r=="number"&&(r&=255);if(0>a||this.length<a||this.length<f)throw new RangeError("Out of range index");if(f<=a)return this;a>>>=0,f=f===void 0?this.length:f>>>0,r||(r=0);var x;if(typeof r=="number")for(x=a;x<f;++x)this[x]=r;else{var P=u.isBuffer(r)?r:u.from(r,S),G=P.length;if(G===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(x=0;x<f-a;++x)this[x+a]=P[x%G]}return this};var w=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,h,c){(function(l){(function(){function p(){let u;try{u=c.storage.getItem("debug")}catch{}return!u&&typeof l<"u"&&"env"in l&&(u=l.env.DEBUG),u}c.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+h.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let y=0,g=0;u[0].replace(/%[a-zA-Z%]/g,C=>{C==="%%"||(y++,C==="%c"&&(g=y))}),u.splice(g,0,d)},c.save=function(u){try{u?c.storage.setItem("debug",u):c.storage.removeItem("debug")}catch{}},c.load=p,c.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),h.exports=o("./common")(c);const{formatters:b}=h.exports;b.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,h){h.exports=function(c){function l(u){function d(...C){if(!d.enabled)return;const M=d,L=+new Date,N=L-(y||L);M.diff=N,M.prev=y,M.curr=L,y=L,C[0]=l.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let m=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(v,T)=>{if(v==="%%")return"%";m++;const E=l.formatters[T];if(typeof E=="function"){const I=C[m];v=E.call(M,I),C.splice(m,1),m--}return v}),l.formatArgs.call(M,C),(M.log||l.log).apply(M,C)}let y,g=null;return d.namespace=u,d.useColors=l.useColors(),d.color=l.selectColor(u),d.extend=p,d.destroy=l.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?l.enabled(u):g,set:C=>{g=C}}),typeof l.init=="function"&&l.init(d),d}function p(u,d){const y=l(this.namespace+(typeof d>"u"?":":d)+u);return y.log=this.log,y}function b(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function(u){return u instanceof Error?u.stack||u.message:u},l.disable=function(){const u=[...l.names.map(b),...l.skips.map(b).map(d=>"-"+d)].join(",");return l.enable(""),u},l.enable=function(u){l.save(u),l.names=[],l.skips=[];let d;const y=(typeof u=="string"?u:"").split(/[\s,]+/),g=y.length;for(d=0;d<g;d++)y[d]&&(u=y[d].replace(/\*/g,".*?"),u[0]==="-"?l.skips.push(new RegExp("^"+u.substr(1)+"$")):l.names.push(new RegExp("^"+u+"$")))},l.enabled=function(u){if(u[u.length-1]==="*")return!0;let d,y;for(d=0,y=l.skips.length;d<y;d++)if(l.skips[d].test(u))return!1;for(d=0,y=l.names.length;d<y;d++)if(l.names[d].test(u))return!0;return!1},l.humanize=o("ms"),l.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(c).forEach(u=>{l[u]=c[u]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function(u){let d=0;for(let y=0;y<u.length;y++)d=(d<<5)-d+u.charCodeAt(y),d|=0;return l.colors[s(d)%l.colors.length]},l.enable(l.load()),l}},{ms:11}],6:[function(o,h){function c(l,p){for(const b in p)Object.defineProperty(l,b,{value:p[b],enumerable:!0,configurable:!0});return l}h.exports=function(l,p,b){if(!l||typeof l=="string")throw new TypeError("Please pass an Error to err-code");b||(b={}),typeof p=="object"&&(b=p,p=""),p&&(b.code=p);try{return c(l,b)}catch{b.message=l.message,b.stack=l.stack;const d=function(){};return d.prototype=Object.create(Object.getPrototypeOf(l)),c(new d,b)}}},{}],7:[function(o,h){function c(k){console&&console.warn&&console.warn(k)}function l(){l.init.call(this)}function p(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function b(k){return k._maxListeners===void 0?l.defaultMaxListeners:k._maxListeners}function u(k,A,F,j){var H,$,X;if(p(F),$=k._events,$===void 0?($=k._events=Object.create(null),k._eventsCount=0):($.newListener!==void 0&&(k.emit("newListener",A,F.listener?F.listener:F),$=k._events),X=$[A]),X===void 0)X=$[A]=F,++k._eventsCount;else if(typeof X=="function"?X=$[A]=j?[F,X]:[X,F]:j?X.unshift(F):X.push(F),H=b(k),0<H&&X.length>H&&!X.warned){X.warned=!0;var st=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+(A+" listeners added. Use emitter.setMaxListeners() to increase limit"));st.name="MaxListenersExceededWarning",st.emitter=k,st.type=A,st.count=X.length,c(st)}return k}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(k,A,F){var j={fired:!1,wrapFn:void 0,target:k,type:A,listener:F},H=d.bind(j);return H.listener=F,j.wrapFn=H,H}function g(k,A,F){var j=k._events;if(j===void 0)return[];var H=j[A];return H===void 0?[]:typeof H=="function"?F?[H.listener||H]:[H]:F?N(H):M(H,H.length)}function C(k){var A=this._events;if(A!==void 0){var F=A[k];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function M(k,A){for(var F=Array(A),j=0;j<A;++j)F[j]=k[j];return F}function L(k,A){for(;A+1<k.length;A++)k[A]=k[A+1];k.pop()}function N(k){for(var A=Array(k.length),F=0;F<A.length;++F)A[F]=k[F].listener||k[F];return A}function m(k,A,F){typeof k.on=="function"&&_(k,"error",A,F)}function _(k,A,F,j){if(typeof k.on=="function")j.once?k.once(A,F):k.on(A,F);else if(typeof k.addEventListener=="function")k.addEventListener(A,function H($){j.once&&k.removeEventListener(A,H),F($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var v,T=typeof Reflect=="object"?Reflect:null,E=T&&typeof T.apply=="function"?T.apply:function(k,A,F){return Function.prototype.apply.call(k,A,F)};v=T&&typeof T.ownKeys=="function"?T.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var I=Number.isNaN||function(k){return k!==k};h.exports=l,h.exports.once=function(k,A){return new Promise(function(F,j){function H(X){k.removeListener(A,$),j(X)}function $(){typeof k.removeListener=="function"&&k.removeListener("error",H),F([].slice.call(arguments))}_(k,A,$,{once:!0}),A!=="error"&&m(k,H,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var U=10;Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(k){if(typeof k!="number"||0>k||I(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");U=k}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||I(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},l.prototype.getMaxListeners=function(){return b(this)},l.prototype.emit=function(k){for(var A=[],F=1;F<arguments.length;F++)A.push(arguments[F]);var j=k==="error",H=this._events;if(H!==void 0)j=j&&H.error===void 0;else if(!j)return!1;if(j){var $;if(0<A.length&&($=A[0]),$ instanceof Error)throw $;var X=new Error("Unhandled error."+($?" ("+$.message+")":""));throw X.context=$,X}var st=H[k];if(st===void 0)return!1;if(typeof st=="function")E(st,this,A);else for(var gt=st.length,W=M(st,gt),F=0;F<gt;++F)E(W[F],this,A);return!0},l.prototype.addListener=function(k,A){return u(this,k,A,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(k,A){return u(this,k,A,!0)},l.prototype.once=function(k,A){return p(A),this.on(k,y(this,k,A)),this},l.prototype.prependOnceListener=function(k,A){return p(A),this.prependListener(k,y(this,k,A)),this},l.prototype.removeListener=function(k,A){var F,j,H,$,X;if(p(A),j=this._events,j===void 0)return this;if(F=j[k],F===void 0)return this;if(F===A||F.listener===A)--this._eventsCount==0?this._events=Object.create(null):(delete j[k],j.removeListener&&this.emit("removeListener",k,F.listener||A));else if(typeof F!="function"){for(H=-1,$=F.length-1;0<=$;$--)if(F[$]===A||F[$].listener===A){X=F[$].listener,H=$;break}if(0>H)return this;H===0?F.shift():L(F,H),F.length===1&&(j[k]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",k,X||A)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(k){var A,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[k]),this;if(arguments.length===0){var H,$=Object.keys(F);for(j=0;j<$.length;++j)H=$[j],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=F[k],typeof A=="function")this.removeListener(k,A);else if(A!==void 0)for(j=A.length-1;0<=j;j--)this.removeListener(k,A[j]);return this},l.prototype.listeners=function(k){return g(this,k,!0)},l.prototype.rawListeners=function(k){return g(this,k,!1)},l.listenerCount=function(k,A){return typeof k.listenerCount=="function"?k.listenerCount(A):C.call(k,A)},l.prototype.listenerCount=C,l.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(o,h){h.exports=function(){if(typeof globalThis>"u")return null;var c={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return c.RTCPeerConnection?c:null}},{}],9:[function(o,h,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(l,p,b,u,d){var y,g,C=8*d-u-1,M=(1<<C)-1,L=M>>1,N=-7,m=b?d-1:0,_=b?-1:1,v=l[p+m];for(m+=_,y=v&(1<<-N)-1,v>>=-N,N+=C;0<N;y=256*y+l[p+m],m+=_,N-=8);for(g=y&(1<<-N)-1,y>>=-N,N+=u;0<N;g=256*g+l[p+m],m+=_,N-=8);if(y===0)y=1-L;else{if(y===M)return g?NaN:(v?-1:1)*(1/0);g+=i(2,u),y-=L}return(v?-1:1)*g*i(2,y-u)},c.write=function(l,p,b,u,d,y){var g,C,M,L=Math.LN2,N=Math.log,m=8*y-d-1,_=(1<<m)-1,v=_>>1,T=d===23?i(2,-24)-i(2,-77):0,E=u?0:y-1,I=u?1:-1,U=0>p||p===0&&0>1/p?1:0;for(p=s(p),isNaN(p)||p===1/0?(C=isNaN(p)?1:0,g=_):(g=e(N(p)/L),1>p*(M=i(2,-g))&&(g--,M*=2),p+=1<=g+v?T/M:T*i(2,1-v),2<=p*M&&(g++,M/=2),g+v>=_?(C=0,g=_):1<=g+v?(C=(p*M-1)*i(2,d),g+=v):(C=p*i(2,v-1)*i(2,d),g=0));8<=d;l[b+E]=255&C,E+=I,C/=256,d-=8);for(g=g<<d|C,m+=d;0<m;l[b+E]=255&g,E+=I,g/=256,m-=8);l[b+E-I]|=128*U}},{}],10:[function(o,h){h.exports=typeof Object.create=="function"?function(c,l){l&&(c.super_=l,c.prototype=Object.create(l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,l){if(l){c.super_=l;var p=function(){};p.prototype=l.prototype,c.prototype=new p,c.prototype.constructor=c}}},{}],11:[function(o,h){var c=Math.round;function l(d){if(d+="",!(100<d.length)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(y){var g=parseFloat(y[1]),C=(y[2]||"ms").toLowerCase();return C==="years"||C==="year"||C==="yrs"||C==="yr"||C==="y"?315576e5*g:C==="weeks"||C==="week"||C==="w"?6048e5*g:C==="days"||C==="day"||C==="d"?864e5*g:C==="hours"||C==="hour"||C==="hrs"||C==="hr"||C==="h"?36e5*g:C==="minutes"||C==="minute"||C==="mins"||C==="min"||C==="m"?6e4*g:C==="seconds"||C==="second"||C==="secs"||C==="sec"||C==="s"?1e3*g:C==="milliseconds"||C==="millisecond"||C==="msecs"||C==="msec"||C==="ms"?g:void 0}}}function p(d){var y=s(d);return 864e5<=y?c(d/864e5)+"d":36e5<=y?c(d/36e5)+"h":6e4<=y?c(d/6e4)+"m":1e3<=y?c(d/1e3)+"s":d+"ms"}function b(d){var y=s(d);return 864e5<=y?u(d,y,864e5,"day"):36e5<=y?u(d,y,36e5,"hour"):6e4<=y?u(d,y,6e4,"minute"):1e3<=y?u(d,y,1e3,"second"):d+" ms"}function u(d,y,g,C){return c(d/g)+" "+C+(y>=1.5*g?"s":"")}h.exports=function(d,y){y=y||{};var g=typeof d;if(g=="string"&&0<d.length)return l(d);if(g==="number"&&isFinite(d))return y.long?b(d):p(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(o,h){function c(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function p(T){if(C===setTimeout)return setTimeout(T,0);if((C===c||!C)&&setTimeout)return C=setTimeout,setTimeout(T,0);try{return C(T,0)}catch{try{return C.call(null,T,0)}catch{return C.call(this,T,0)}}}function b(T){if(M===clearTimeout)return clearTimeout(T);if((M===l||!M)&&clearTimeout)return M=clearTimeout,clearTimeout(T);try{return M(T)}catch{try{return M.call(null,T)}catch{return M.call(this,T)}}}function u(){_&&N&&(_=!1,N.length?m=N.concat(m):v=-1,m.length&&d())}function d(){if(!_){var T=p(u);_=!0;for(var E=m.length;E;){for(N=m,m=[];++v<E;)N&&N[v].run();v=-1,E=m.length}N=null,_=!1,b(T)}}function y(T,E){this.fun=T,this.array=E}function g(){}var C,M,L=h.exports={};(function(){try{C=typeof setTimeout=="function"?setTimeout:c}catch{C=c}try{M=typeof clearTimeout=="function"?clearTimeout:l}catch{M=l}})();var N,m=[],_=!1,v=-1;L.nextTick=function(T){var E=Array(arguments.length-1);if(1<arguments.length)for(var I=1;I<arguments.length;I++)E[I-1]=arguments[I];m.push(new y(T,E)),m.length!==1||_||p(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=g,L.addListener=g,L.once=g,L.off=g,L.removeListener=g,L.removeAllListeners=g,L.emit=g,L.prependListener=g,L.prependOnceListener=g,L.listeners=function(){return[]},L.binding=function(){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],13:[function(o,h){(function(c){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let l;h.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?c:window):p=>(l||(l=Promise.resolve())).then(p).catch(b=>setTimeout(()=>{throw b},0))}).call(this)}).call(this,typeof Tt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Tt)},{}],14:[function(o,h){(function(c,l){(function(){var p=o("safe-buffer").Buffer,b=l.crypto||l.msCrypto;h.exports=b&&b.getRandomValues?function(u,d){if(u>4294967295)throw new RangeError("requested too many random bytes");var y=p.allocUnsafe(u);if(0<u)if(65536<u)for(var g=0;g<u;g+=65536)b.getRandomValues(y.slice(g,g+65536));else b.getRandomValues(y);return typeof d=="function"?c.nextTick(function(){d(null,y)}):y}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof Tt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Tt)},{_process:12,"safe-buffer":30}],15:[function(o,h){function c(g,C){g.prototype=Object.create(C.prototype),g.prototype.constructor=g,g.__proto__=C}function l(g,C,M){function L(m,_,v){return typeof C=="string"?C:C(m,_,v)}M||(M=Error);var N=function(m){function _(v,T,E){return m.call(this,L(v,T,E))||this}return c(_,m),_}(M);N.prototype.name=M.name,N.prototype.code=g,y[g]=N}function p(g,C){if(Array.isArray(g)){var M=g.length;return g=g.map(function(L){return L+""}),2<M?"one of ".concat(C," ").concat(g.slice(0,M-1).join(", "),", or ")+g[M-1]:M===2?"one of ".concat(C," ").concat(g[0]," or ").concat(g[1]):"of ".concat(C," ").concat(g[0])}return"of ".concat(C," ").concat(g+"")}function b(g,C,M){return g.substr(0,C.length)===C}function u(g,C,M){return(M===void 0||M>g.length)&&(M=g.length),g.substring(M-C.length,M)===C}function d(g,C,M){return typeof M!="number"&&(M=0),!(M+C.length>g.length)&&g.indexOf(C,M)!==-1}var y={};l("ERR_INVALID_OPT_VALUE",function(g,C){return'The value "'+C+'" is invalid for option "'+g+'"'},TypeError),l("ERR_INVALID_ARG_TYPE",function(g,C,M){var L;typeof C=="string"&&b(C,"not ")?(L="must not be",C=C.replace(/^not /,"")):L="must be";var N;if(u(g," argument"))N="The ".concat(g," ").concat(L," ").concat(p(C,"type"));else{var m=d(g,".")?"property":"argument";N='The "'.concat(g,'" ').concat(m," ").concat(L," ").concat(p(C,"type"))}return N+=". Received type ".concat(typeof M),N},TypeError),l("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),l("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),l("ERR_STREAM_PREMATURE_CLOSE","Premature close"),l("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),l("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),l("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),l("ERR_STREAM_WRITE_AFTER_END","write after end"),l("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),l("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),l("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),h.exports.codes=y},{}],16:[function(o,h){(function(c){(function(){function l(L){return this instanceof l?(d.call(this,L),y.call(this,L),this.allowHalfOpen=!0,void(L&&(L.readable===!1&&(this.readable=!1),L.writable===!1&&(this.writable=!1),L.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p))))):new l(L)}function p(){this._writableState.ended||c.nextTick(b,this)}function b(L){L.end()}var u=Object.keys||function(L){var N=[];for(var m in L)N.push(m);return N};h.exports=l;var d=o("./_stream_readable"),y=o("./_stream_writable");o("inherits")(l,d);for(var g,C=u(y.prototype),M=0;M<C.length;M++)g=C[M],l.prototype[g]||(l.prototype[g]=y.prototype[g]);Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(L){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=L,this._writableState.destroyed=L)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,h){function c(p){return this instanceof c?void l.call(this,p):new c(p)}h.exports=c;var l=o("./_stream_transform");o("inherits")(c,l),c.prototype._transform=function(p,b,u){u(null,p)}},{"./_stream_transform":19,inherits:10}],18:[function(o,h){(function(c,l){(function(){function p(w){return Wt.from(w)}function b(w){return Wt.isBuffer(w)||w instanceof nt}function u(w,r,a){return typeof w.prependListener=="function"?w.prependListener(r,a):void(w._events&&w._events[r]?Array.isArray(w._events[r])?w._events[r].unshift(a):w._events[r]=[a,w._events[r]]:w.on(r,a))}function d(w,r,a){gt=gt||o("./_stream_duplex"),w=w||{},typeof a!="boolean"&&(a=r instanceof gt),this.objectMode=!!w.objectMode,a&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=De(this,w,"readableHighWaterMark",a),this.buffer=new Ae,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(!St&&(St=o("string_decoder/").StringDecoder),this.decoder=new St(w.encoding),this.encoding=w.encoding)}function y(w){if(gt=gt||o("./_stream_duplex"),!(this instanceof y))return new y(w);var r=this instanceof gt;this._readableState=new d(w,this,r),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),Ct.call(this)}function g(w,r,a,f,S){W("readableAddChunk",r);var R=w._readableState;if(r===null)R.reading=!1,m(w,R);else{var x;if(S||(x=M(R,r)),x)B(w,x);else if(!(R.objectMode||r&&0<r.length))f||(R.reading=!1,T(w,R));else if(typeof r=="string"||R.objectMode||Object.getPrototypeOf(r)===Wt.prototype||(r=p(r)),f)R.endEmitted?B(w,new O):C(w,R,r,!0);else if(R.ended)B(w,new kt);else{if(R.destroyed)return!1;R.reading=!1,R.decoder&&!a?(r=R.decoder.write(r),R.objectMode||r.length!==0?C(w,R,r,!1):T(w,R)):C(w,R,r,!1)}}return!R.ended&&(R.length<R.highWaterMark||R.length===0)}function C(w,r,a,f){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,w.emit("data",a)):(r.length+=r.objectMode?1:a.length,f?r.buffer.unshift(a):r.buffer.push(a),r.needReadable&&_(w)),T(w,r)}function M(w,r){var a;return b(r)||typeof r=="string"||r===void 0||w.objectMode||(a=new Et("chunk",["string","Buffer","Uint8Array"],r)),a}function L(w){return 1073741824<=w?w=1073741824:(w--,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,w|=w>>>16,w++),w}function N(w,r){return 0>=w||r.length===0&&r.ended?0:r.objectMode?1:w===w?(w>r.highWaterMark&&(r.highWaterMark=L(w)),w<=r.length?w:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function m(w,r){if(W("onEofChunk"),!r.ended){if(r.decoder){var a=r.decoder.end();a&&a.length&&(r.buffer.push(a),r.length+=r.objectMode?1:a.length)}r.ended=!0,r.sync?_(w):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,v(w)))}}function _(w){var r=w._readableState;W("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(W("emitReadable",r.flowing),r.emittedReadable=!0,c.nextTick(v,w))}function v(w){var r=w._readableState;W("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(w.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,j(w)}function T(w,r){r.readingMore||(r.readingMore=!0,c.nextTick(E,w,r))}function E(w,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var a=r.length;if(W("maybeReadMore read 0"),w.read(0),a===r.length)break}r.readingMore=!1}function I(w){return function(){var r=w._readableState;W("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&he(w,"data")&&(r.flowing=!0,j(w))}}function U(w){var r=w._readableState;r.readableListening=0<w.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<w.listenerCount("data")&&w.resume()}function k(w){W("readable nexttick read 0"),w.read(0)}function A(w,r){r.resumeScheduled||(r.resumeScheduled=!0,c.nextTick(F,w,r))}function F(w,r){W("resume",r.reading),r.reading||w.read(0),r.resumeScheduled=!1,w.emit("resume"),j(w),r.flowing&&!r.reading&&w.read(0)}function j(w){var r=w._readableState;for(W("flow",r.flowing);r.flowing&&w.read()!==null;);}function H(w,r){if(r.length===0)return null;var a;return r.objectMode?a=r.buffer.shift():!w||w>=r.length?(a=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):a=r.buffer.consume(w,r.decoder),a}function $(w){var r=w._readableState;W("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,c.nextTick(X,r,w))}function X(w,r){if(W("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,r.readable=!1,r.emit("end"),w.autoDestroy)){var a=r._writableState;(!a||a.autoDestroy&&a.finished)&&r.destroy()}}function st(w,r){for(var a=0,f=w.length;a<f;a++)if(w[a]===r)return a;return-1}h.exports=y;var gt;y.ReadableState=d;var W;o("events").EventEmitter;var he=function(w,r){return w.listeners(r).length},Ct=o("./internal/streams/stream"),Wt=o("buffer").Buffer,nt=l.Uint8Array||function(){},Z=o("util");W=Z&&Z.debuglog?Z.debuglog("stream"):function(){};var St,Ht,Yt,Ae=o("./internal/streams/buffer_list"),Zt=o("./internal/streams/destroy"),Qt=o("./internal/streams/state"),De=Qt.getHighWaterMark,$t=o("../errors").codes,Et=$t.ERR_INVALID_ARG_TYPE,kt=$t.ERR_STREAM_PUSH_AFTER_EOF,D=$t.ERR_METHOD_NOT_IMPLEMENTED,O=$t.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(y,Ct);var B=Zt.errorOrDestroy,V=["error","close","destroy","pause","resume"];Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),y.prototype.destroy=Zt.destroy,y.prototype._undestroy=Zt.undestroy,y.prototype._destroy=function(w,r){r(w)},y.prototype.push=function(w,r){var a,f=this._readableState;return f.objectMode?a=!0:typeof w=="string"&&(r=r||f.defaultEncoding,r!==f.encoding&&(w=Wt.from(w,r),r=""),a=!0),g(this,w,r,!1,a)},y.prototype.unshift=function(w){return g(this,w,null,!0,!1)},y.prototype.isPaused=function(){return this._readableState.flowing===!1},y.prototype.setEncoding=function(w){St||(St=o("string_decoder/").StringDecoder);var r=new St(w);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var a=this._readableState.buffer.head,f="";a!==null;)f+=r.write(a.data),a=a.next;return this._readableState.buffer.clear(),f!==""&&this._readableState.buffer.push(f),this._readableState.length=f.length,this},y.prototype.read=function(w){W("read",w),w=parseInt(w,10);var r=this._readableState,a=w;if(w!==0&&(r.emittedReadable=!1),w===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return W("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?$(this):_(this),null;if(w=N(w,r),w===0&&r.ended)return r.length===0&&$(this),null;var f=r.needReadable;W("need readable",f),(r.length===0||r.length-w<r.highWaterMark)&&(f=!0,W("length less than watermark",f)),r.ended||r.reading?(f=!1,W("reading or ended",f)):f&&(W("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(w=N(a,r)));var S;return S=0<w?H(w,r):null,S===null?(r.needReadable=r.length<=r.highWaterMark,w=0):(r.length-=w,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),a!==w&&r.ended&&$(this)),S!==null&&this.emit("data",S),S},y.prototype._read=function(){B(this,new D("_read()"))},y.prototype.pipe=function(w,r){function a(fe,de){W("onunpipe"),fe===J&&de&&de.hasUnpiped===!1&&(de.hasUnpiped=!0,S())}function f(){W("onend"),w.end()}function S(){W("cleanup"),w.removeListener("close",P),w.removeListener("finish",G),w.removeListener("drain",ue),w.removeListener("error",x),w.removeListener("unpipe",a),J.removeListener("end",f),J.removeListener("end",tt),J.removeListener("data",R),Ie=!0,z.awaitDrain&&(!w._writableState||w._writableState.needDrain)&&ue()}function R(fe){W("ondata");var de=w.write(fe);W("dest.write",de),de===!1&&((z.pipesCount===1&&z.pipes===w||1<z.pipesCount&&st(z.pipes,w)!==-1)&&!Ie&&(W("false write response, pause",z.awaitDrain),z.awaitDrain++),J.pause())}function x(fe){W("onerror",fe),tt(),w.removeListener("error",x),he(w,"error")===0&&B(w,fe)}function P(){w.removeListener("finish",G),tt()}function G(){W("onfinish"),w.removeListener("close",P),tt()}function tt(){W("unpipe"),J.unpipe(w)}var J=this,z=this._readableState;switch(z.pipesCount){case 0:z.pipes=w;break;case 1:z.pipes=[z.pipes,w];break;default:z.pipes.push(w)}z.pipesCount+=1,W("pipe count=%d opts=%j",z.pipesCount,r);var ut=(!r||r.end!==!1)&&w!==c.stdout&&w!==c.stderr,te=ut?f:tt;z.endEmitted?c.nextTick(te):J.once("end",te),w.on("unpipe",a);var ue=I(J);w.on("drain",ue);var Ie=!1;return J.on("data",R),u(w,"error",x),w.once("close",P),w.once("finish",G),w.emit("pipe",J),z.flowing||(W("pipe resume"),J.resume()),w},y.prototype.unpipe=function(w){var r=this._readableState,a={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return w&&w!==r.pipes?this:(w||(w=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,w&&w.emit("unpipe",this,a),this);if(!w){var f=r.pipes,S=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var R=0;R<S;R++)f[R].emit("unpipe",this,{hasUnpiped:!1});return this}var x=st(r.pipes,w);return x===-1?this:(r.pipes.splice(x,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),w.emit("unpipe",this,a),this)},y.prototype.on=function(w,r){var a=Ct.prototype.on.call(this,w,r),f=this._readableState;return w==="data"?(f.readableListening=0<this.listenerCount("readable"),f.flowing!==!1&&this.resume()):w=="readable"&&!f.endEmitted&&!f.readableListening&&(f.readableListening=f.needReadable=!0,f.flowing=!1,f.emittedReadable=!1,W("on readable",f.length,f.reading),f.length?_(this):!f.reading&&c.nextTick(k,this)),a},y.prototype.addListener=y.prototype.on,y.prototype.removeListener=function(w,r){var a=Ct.prototype.removeListener.call(this,w,r);return w==="readable"&&c.nextTick(U,this),a},y.prototype.removeAllListeners=function(w){var r=Ct.prototype.removeAllListeners.apply(this,arguments);return(w==="readable"||w===void 0)&&c.nextTick(U,this),r},y.prototype.resume=function(){var w=this._readableState;return w.flowing||(W("resume"),w.flowing=!w.readableListening,A(this,w)),w.paused=!1,this},y.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},y.prototype.wrap=function(w){var r=this,a=this._readableState,f=!1;for(var S in w.on("end",function(){if(W("wrapped end"),a.decoder&&!a.ended){var x=a.decoder.end();x&&x.length&&r.push(x)}r.push(null)}),w.on("data",function(x){if(W("wrapped data"),a.decoder&&(x=a.decoder.write(x)),!(a.objectMode&&x==null)&&(a.objectMode||x&&x.length)){var P=r.push(x);P||(f=!0,w.pause())}}),w)this[S]===void 0&&typeof w[S]=="function"&&(this[S]=function(x){return function(){return w[x].apply(w,arguments)}}(S));for(var R=0;R<V.length;R++)w.on(V[R],this.emit.bind(this,V[R]));return this._read=function(x){W("wrapped _read",x),f&&(f=!1,w.resume())},this},typeof Symbol=="function"&&(y.prototype[Symbol.asyncIterator]=function(){return Ht===void 0&&(Ht=o("./internal/streams/async_iterator")),Ht(this)}),Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(y.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(y.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),y._fromList=H,Object.defineProperty(y.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(y.from=function(w,r){return Yt===void 0&&(Yt=o("./internal/streams/from")),Yt(y,w,r)})}).call(this)}).call(this,o("_process"),typeof Tt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Tt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,h){function c(L,N){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new y);m.writechunk=null,m.writecb=null,N!=null&&this.push(N),_(L);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function l(L){return this instanceof l?(M.call(this,L),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,L&&(typeof L.transform=="function"&&(this._transform=L.transform),typeof L.flush=="function"&&(this._flush=L.flush)),void this.on("prefinish",p)):new l(L)}function p(){var L=this;typeof this._flush!="function"||this._readableState.destroyed?b(this,null,null):this._flush(function(N,m){b(L,N,m)})}function b(L,N,m){if(N)return L.emit("error",N);if(m!=null&&L.push(m),L._writableState.length)throw new C;if(L._transformState.transforming)throw new g;return L.push(null)}h.exports=l;var u=o("../errors").codes,d=u.ERR_METHOD_NOT_IMPLEMENTED,y=u.ERR_MULTIPLE_CALLBACK,g=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,C=u.ERR_TRANSFORM_WITH_LENGTH_0,M=o("./_stream_duplex");o("inherits")(l,M),l.prototype.push=function(L,N){return this._transformState.needTransform=!1,M.prototype.push.call(this,L,N)},l.prototype._transform=function(L,N,m){m(new d("_transform()"))},l.prototype._write=function(L,N,m){var _=this._transformState;if(_.writecb=m,_.writechunk=L,_.writeencoding=N,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},l.prototype._read=function(){var L=this._transformState;L.writechunk===null||L.transforming?L.needTransform=!0:(L.transforming=!0,this._transform(L.writechunk,L.writeencoding,L.afterTransform))},l.prototype._destroy=function(L,N){M.prototype._destroy.call(this,L,function(m){N(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,h){(function(c,l){(function(){function p(D){var O=this;this.next=null,this.entry=null,this.finish=function(){$(O,D)}}function b(D){return W.from(D)}function u(D){return W.isBuffer(D)||D instanceof he}function d(){}function y(D,O,B){X=X||o("./_stream_duplex"),D=D||{},typeof B!="boolean"&&(B=O instanceof X),this.objectMode=!!D.objectMode,B&&(this.objectMode=this.objectMode||!!D.writableObjectMode),this.highWaterMark=nt(this,D,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=D.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(w){T(O,w)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function g(D){X=X||o("./_stream_duplex");var O=this instanceof X;return O||kt.call(g,this)?(this._writableState=new y(D,this,O),this.writable=!0,D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final)),void gt.call(this)):new g(D)}function C(D,O){var B=new De;Et(D,B),c.nextTick(O,B)}function M(D,O,B,V){var w;return B===null?w=new Qt:typeof B!="string"&&!O.objectMode&&(w=new St("chunk",["string","Buffer"],B)),!w||(Et(D,w),c.nextTick(V,w),!1)}function L(D,O,B){return D.objectMode||D.decodeStrings===!1||typeof O!="string"||(O=W.from(O,B)),O}function N(D,O,B,V,w,r){if(!B){var a=L(O,V,w);V!==a&&(B=!0,w="buffer",V=a)}var f=O.objectMode?1:V.length;O.length+=f;var S=O.length<O.highWaterMark;if(S||(O.needDrain=!0),O.writing||O.corked){var R=O.lastBufferedRequest;O.lastBufferedRequest={chunk:V,encoding:w,isBuf:B,callback:r,next:null},R?R.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else m(D,O,!1,f,V,w,r);return S}function m(D,O,B,V,w,r,a){O.writelen=V,O.writecb=a,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new Zt("write")):B?D._writev(w,O.onwrite):D._write(w,r,O.onwrite),O.sync=!1}function _(D,O,B,V,w){--O.pendingcb,B?(c.nextTick(w,V),c.nextTick(j,D,O),D._writableState.errorEmitted=!0,Et(D,V)):(w(V),D._writableState.errorEmitted=!0,Et(D,V),j(D,O))}function v(D){D.writing=!1,D.writecb=null,D.length-=D.writelen,D.writelen=0}function T(D,O){var B=D._writableState,V=B.sync,w=B.writecb;if(typeof w!="function")throw new Yt;if(v(B),O)_(D,B,V,O,w);else{var r=k(B)||D.destroyed;r||B.corked||B.bufferProcessing||!B.bufferedRequest||U(D,B),V?c.nextTick(E,D,B,r,w):E(D,B,r,w)}}function E(D,O,B,V){B||I(D,O),O.pendingcb--,V(),j(D,O)}function I(D,O){O.length===0&&O.needDrain&&(O.needDrain=!1,D.emit("drain"))}function U(D,O){O.bufferProcessing=!0;var B=O.bufferedRequest;if(D._writev&&B&&B.next){var V=O.bufferedRequestCount,w=Array(V),r=O.corkedRequestsFree;r.entry=B;for(var a=0,f=!0;B;)w[a]=B,B.isBuf||(f=!1),B=B.next,a+=1;w.allBuffers=f,m(D,O,!0,O.length,w,"",r.finish),O.pendingcb++,O.lastBufferedRequest=null,r.next?(O.corkedRequestsFree=r.next,r.next=null):O.corkedRequestsFree=new p(O),O.bufferedRequestCount=0}else{for(;B;){var S=B.chunk,R=B.encoding,x=B.callback,P=O.objectMode?1:S.length;if(m(D,O,!1,P,S,R,x),B=B.next,O.bufferedRequestCount--,O.writing)break}B===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=B,O.bufferProcessing=!1}function k(D){return D.ending&&D.length===0&&D.bufferedRequest===null&&!D.finished&&!D.writing}function A(D,O){D._final(function(B){O.pendingcb--,B&&Et(D,B),O.prefinished=!0,D.emit("prefinish"),j(D,O)})}function F(D,O){O.prefinished||O.finalCalled||(typeof D._final!="function"||O.destroyed?(O.prefinished=!0,D.emit("prefinish")):(O.pendingcb++,O.finalCalled=!0,c.nextTick(A,D,O)))}function j(D,O){var B=k(O);if(B&&(F(D,O),O.pendingcb===0&&(O.finished=!0,D.emit("finish"),O.autoDestroy))){var V=D._readableState;(!V||V.autoDestroy&&V.endEmitted)&&D.destroy()}return B}function H(D,O,B){O.ending=!0,j(D,O),B&&(O.finished?c.nextTick(B):D.once("finish",B)),O.ended=!0,D.writable=!1}function $(D,O,B){var V=D.entry;for(D.entry=null;V;){var w=V.callback;O.pendingcb--,w(B),V=V.next}O.corkedRequestsFree.next=D}h.exports=g;var X;g.WritableState=y;var st={deprecate:o("util-deprecate")},gt=o("./internal/streams/stream"),W=o("buffer").Buffer,he=l.Uint8Array||function(){},Ct=o("./internal/streams/destroy"),Wt=o("./internal/streams/state"),nt=Wt.getHighWaterMark,Z=o("../errors").codes,St=Z.ERR_INVALID_ARG_TYPE,Ht=Z.ERR_METHOD_NOT_IMPLEMENTED,Yt=Z.ERR_MULTIPLE_CALLBACK,Ae=Z.ERR_STREAM_CANNOT_PIPE,Zt=Z.ERR_STREAM_DESTROYED,Qt=Z.ERR_STREAM_NULL_VALUES,De=Z.ERR_STREAM_WRITE_AFTER_END,$t=Z.ERR_UNKNOWN_ENCODING,Et=Ct.errorOrDestroy;o("inherits")(g,gt),y.prototype.getBuffer=function(){for(var D=this.bufferedRequest,O=[];D;)O.push(D),D=D.next;return O},function(){try{Object.defineProperty(y.prototype,"buffer",{get:st.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var kt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(kt=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(D){return!!kt.call(this,D)||this===g&&D&&D._writableState instanceof y}})):kt=function(D){return D instanceof this},g.prototype.pipe=function(){Et(this,new Ae)},g.prototype.write=function(D,O,B){var V=this._writableState,w=!1,r=!V.objectMode&&u(D);return r&&!W.isBuffer(D)&&(D=b(D)),typeof O=="function"&&(B=O,O=null),r?O="buffer":!O&&(O=V.defaultEncoding),typeof B!="function"&&(B=d),V.ending?C(this,B):(r||M(this,V,D,B))&&(V.pendingcb++,w=N(this,V,r,D,O,B)),w},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var D=this._writableState;D.corked&&(D.corked--,!D.writing&&!D.corked&&!D.bufferProcessing&&D.bufferedRequest&&U(this,D))},g.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())))throw new $t(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(D,O,B){B(new Ht("_write()"))},g.prototype._writev=null,g.prototype.end=function(D,O,B){var V=this._writableState;return typeof D=="function"?(B=D,D=null,O=null):typeof O=="function"&&(B=O,O=null),D!=null&&this.write(D,O),V.corked&&(V.corked=1,this.uncork()),V.ending||H(this,V,B),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),g.prototype.destroy=Ct.destroy,g.prototype._undestroy=Ct.undestroy,g.prototype._destroy=function(D,O){O(D)}}).call(this)}).call(this,o("_process"),typeof Tt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Tt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,h){(function(c){(function(){function l(I,U,k){return U in I?Object.defineProperty(I,U,{value:k,enumerable:!0,configurable:!0,writable:!0}):I[U]=k,I}function p(I,U){return{value:I,done:U}}function b(I){var U=I[C];if(U!==null){var k=I[v].read();k!==null&&(I[m]=null,I[C]=null,I[M]=null,U(p(k,!1)))}}function u(I){c.nextTick(b,I)}function d(I,U){return function(k,A){I.then(function(){return U[N]?void k(p(void 0,!0)):void U[_](k,A)},A)}}var y,g=o("./end-of-stream"),C=Symbol("lastResolve"),M=Symbol("lastReject"),L=Symbol("error"),N=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),T=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((y={get stream(){return this[v]},next:function(){var I=this,U=this[L];if(U!==null)return Promise.reject(U);if(this[N])return Promise.resolve(p(void 0,!0));if(this[v].destroyed)return new Promise(function(j,H){c.nextTick(function(){I[L]?H(I[L]):j(p(void 0,!0))})});var k,A=this[m];if(A)k=new Promise(d(A,this));else{var F=this[v].read();if(F!==null)return Promise.resolve(p(F,!1));k=new Promise(this[_])}return this[m]=k,k}},l(y,Symbol.asyncIterator,function(){return this}),l(y,"return",function(){var I=this;return new Promise(function(U,k){I[v].destroy(null,function(A){return A?void k(A):void U(p(void 0,!0))})})}),y),T);h.exports=function(I){var U,k=Object.create(E,(U={},l(U,v,{value:I,writable:!0}),l(U,C,{value:null,writable:!0}),l(U,M,{value:null,writable:!0}),l(U,L,{value:null,writable:!0}),l(U,N,{value:I._readableState.endEmitted,writable:!0}),l(U,_,{value:function(A,F){var j=k[v].read();j?(k[m]=null,k[C]=null,k[M]=null,A(p(j,!1))):(k[C]=A,k[M]=F)},writable:!0}),U));return k[m]=null,g(I,function(A){if(A&&A.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=k[M];return F!==null&&(k[m]=null,k[C]=null,k[M]=null,F(A)),void(k[L]=A)}var j=k[C];j!==null&&(k[m]=null,k[C]=null,k[M]=null,j(p(void 0,!0))),k[N]=!0}),I.on("readable",u.bind(null,k)),k}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,h){function c(m,_){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(m);_&&(T=T.filter(function(E){return Object.getOwnPropertyDescriptor(m,E).enumerable})),v.push.apply(v,T)}return v}function l(m){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?c(Object(_),!0).forEach(function(T){p(m,T,_[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):c(Object(_)).forEach(function(T){Object.defineProperty(m,T,Object.getOwnPropertyDescriptor(_,T))});return m}function p(m,_,v){return _ in m?Object.defineProperty(m,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):m[_]=v,m}function b(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function u(m,_){for(var v,T=0;T<_.length;T++)v=_[T],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(m,v.key,v)}function d(m,_,v){return _&&u(m.prototype,_),m}function y(m,_,v){C.prototype.copy.call(m,_,v)}var g=o("buffer"),C=g.Buffer,M=o("util"),L=M.inspect,N=L&&L.custom||"inspect";h.exports=function(){function m(){b(this,m),this.head=null,this.tail=null,this.length=0}return d(m,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,T=""+v.data;v=v.next;)T+=_+v.data;return T}},{key:"concat",value:function(_){if(this.length===0)return C.alloc(0);for(var v=C.allocUnsafe(_>>>0),T=this.head,E=0;T;)y(T.data,v,E),E+=T.data.length,T=T.next;return v}},{key:"consume",value:function(_,v){var T;return _<this.head.data.length?(T=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?T=this.shift():T=v?this._getString(_):this._getBuffer(_),T}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,T=1,E=v.data;for(_-=E.length;v=v.next;){var I=v.data,U=_>I.length?I.length:_;if(E+=U===I.length?I:I.slice(0,_),_-=U,_===0){U===I.length?(++T,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=I.slice(U));break}++T}return this.length-=T,E}},{key:"_getBuffer",value:function(_){var v=C.allocUnsafe(_),T=this.head,E=1;for(T.data.copy(v),_-=T.data.length;T=T.next;){var I=T.data,U=_>I.length?I.length:_;if(I.copy(v,v.length-_,0,U),_-=U,_===0){U===I.length?(++E,this.head=T.next?T.next:this.tail=null):(this.head=T,T.data=I.slice(U));break}++E}return this.length-=E,v}},{key:N,value:function(_,v){return L(this,l({},v,{depth:0,customInspect:!1}))}}]),m}()},{buffer:3,util:2}],23:[function(o,h){(function(c){(function(){function l(u,d){b(u,d),p(u)}function p(u){u._writableState&&!u._writableState.emitClose||u._readableState&&!u._readableState.emitClose||u.emit("close")}function b(u,d){u.emit("error",d)}h.exports={destroy:function(u,d){var y=this,g=this._readableState&&this._readableState.destroyed,C=this._writableState&&this._writableState.destroyed;return g||C?(d?d(u):u&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,c.nextTick(b,this,u)):c.nextTick(b,this,u)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(u||null,function(M){!d&&M?y._writableState?y._writableState.errorEmitted?c.nextTick(p,y):(y._writableState.errorEmitted=!0,c.nextTick(l,y,M)):c.nextTick(l,y,M):d?(c.nextTick(p,y),d(M)):c.nextTick(p,y)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(u,d){var y=u._readableState,g=u._writableState;y&&y.autoDestroy||g&&g.autoDestroy?u.destroy(d):u.emit("error",d)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,h){function c(d){var y=!1;return function(){if(!y){y=!0;for(var g=arguments.length,C=Array(g),M=0;M<g;M++)C[M]=arguments[M];d.apply(this,C)}}}function l(){}function p(d){return d.setHeader&&typeof d.abort=="function"}function b(d,y,g){if(typeof y=="function")return b(d,null,y);y||(y={}),g=c(g||l);var C=y.readable||y.readable!==!1&&d.readable,M=y.writable||y.writable!==!1&&d.writable,L=function(){d.writable||m()},N=d._writableState&&d._writableState.finished,m=function(){M=!1,N=!0,C||g.call(d)},_=d._readableState&&d._readableState.endEmitted,v=function(){C=!1,_=!0,M||g.call(d)},T=function(U){g.call(d,U)},E=function(){var U;return C&&!_?(d._readableState&&d._readableState.ended||(U=new u),g.call(d,U)):M&&!N?(d._writableState&&d._writableState.ended||(U=new u),g.call(d,U)):void 0},I=function(){d.req.on("finish",m)};return p(d)?(d.on("complete",m),d.on("abort",E),d.req?I():d.on("request",I)):M&&!d._writableState&&(d.on("end",L),d.on("close",L)),d.on("end",v),d.on("finish",m),y.error!==!1&&d.on("error",T),d.on("close",E),function(){d.removeListener("complete",m),d.removeListener("abort",E),d.removeListener("request",I),d.req&&d.req.removeListener("finish",m),d.removeListener("end",L),d.removeListener("close",L),d.removeListener("finish",m),d.removeListener("end",v),d.removeListener("error",T),d.removeListener("close",E)}}var u=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;h.exports=b},{"../../../errors":15}],25:[function(o,h){h.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,h){function c(N){var m=!1;return function(){m||(m=!0,N.apply(void 0,arguments))}}function l(N){if(N)throw N}function p(N){return N.setHeader&&typeof N.abort=="function"}function b(N,m,_,v){v=c(v);var T=!1;N.on("close",function(){T=!0}),g===void 0&&(g=o("./end-of-stream")),g(N,{readable:m,writable:_},function(I){return I?v(I):(T=!0,void v())});var E=!1;return function(I){if(!T)return E?void 0:(E=!0,p(N)?N.abort():typeof N.destroy=="function"?N.destroy():void v(I||new L("pipe")))}}function u(N){N()}function d(N,m){return N.pipe(m)}function y(N){return N.length&&typeof N[N.length-1]=="function"?N.pop():l}var g,C=o("../../../errors").codes,M=C.ERR_MISSING_ARGS,L=C.ERR_STREAM_DESTROYED;h.exports=function(){for(var N=arguments.length,m=Array(N),_=0;_<N;_++)m[_]=arguments[_];var v=y(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new M("streams");var T,E=m.map(function(I,U){var k=U<m.length-1;return b(I,k,0<U,function(A){T||(T=A),A&&E.forEach(u),k||(E.forEach(u),v(T))})});return m.reduce(d)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,h){function c(p,b,u){return p.highWaterMark==null?b?p[u]:null:p.highWaterMark}var l=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;h.exports={getHighWaterMark:function(p,b,u,d){var y=c(b,d,u);if(y!=null){if(!(isFinite(y)&&e(y)===y)||0>y){var g=d?u:"highWaterMark";throw new l(g,y)}return e(y)}return p.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,h){h.exports=o("events").EventEmitter},{events:7}],29:[function(o,h,c){c=h.exports=o("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=o("./lib/_stream_writable.js"),c.Duplex=o("./lib/_stream_duplex.js"),c.Transform=o("./lib/_stream_transform.js"),c.PassThrough=o("./lib/_stream_passthrough.js"),c.finished=o("./lib/internal/streams/end-of-stream.js"),c.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,h,c){function l(d,y){for(var g in d)y[g]=d[g]}function p(d,y,g){return u(d,y,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var b=o("buffer"),u=b.Buffer;u.from&&u.alloc&&u.allocUnsafe&&u.allocUnsafeSlow?h.exports=b:(l(b,c),c.Buffer=p),p.prototype=Object.create(u.prototype),l(u,p),p.from=function(d,y,g){if(typeof d=="number")throw new TypeError("Argument must not be a number");return u(d,y,g)},p.alloc=function(d,y,g){if(typeof d!="number")throw new TypeError("Argument must be a number");var C=u(d);return y===void 0?C.fill(0):typeof g=="string"?C.fill(y,g):C.fill(y),C},p.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return u(d)},p.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return b.SlowBuffer(d)}},{buffer:3}],31:[function(o,h,c){function l(E){if(!E)return"utf8";for(var I;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(I)return;E=(""+E).toLowerCase(),I=!0}}function p(E){var I=l(E);if(typeof I!="string"&&(v.isEncoding===T||!T(E)))throw new Error("Unknown encoding: "+E);return I||E}function b(E){this.encoding=p(E);var I;switch(this.encoding){case"utf16le":this.text=C,this.end=M,I=4;break;case"utf8":this.fillLast=g,I=4;break;case"base64":this.text=L,this.end=N,I=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(I)}function u(E){return 127>=E?0:E>>5==6?2:E>>4==14?3:E>>3==30?4:E>>6==2?-1:-2}function d(E,I,U){var k=I.length-1;if(k<U)return 0;var A=u(I[k]);return 0<=A?(0<A&&(E.lastNeed=A-1),A):--k<U||A===-2?0:(A=u(I[k]),0<=A?(0<A&&(E.lastNeed=A-2),A):--k<U||A===-2?0:(A=u(I[k]),0<=A?(0<A&&(A===2?A=0:E.lastNeed=A-3),A):0))}function y(E,I){if((192&I[0])!=128)return E.lastNeed=0,"";if(1<E.lastNeed&&1<I.length){if((192&I[1])!=128)return E.lastNeed=1,"";if(2<E.lastNeed&&2<I.length&&(192&I[2])!=128)return E.lastNeed=2,""}}function g(E){var I=this.lastTotal-this.lastNeed,U=y(this,E);return U===void 0?this.lastNeed<=E.length?(E.copy(this.lastChar,I,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,I,0,E.length),void(this.lastNeed-=E.length)):U}function C(E,I){if((E.length-I)%2==0){var U=E.toString("utf16le",I);if(U){var k=U.charCodeAt(U.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",I,E.length-1)}function M(E){var I=E&&E.length?this.write(E):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return I+this.lastChar.toString("utf16le",0,U)}return I}function L(E,I){var U=(E.length-I)%3;return U==0?E.toString("base64",I):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",I,E.length-U))}function N(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+this.lastChar.toString("base64",0,3-this.lastNeed):I}function m(E){return E.toString(this.encoding)}function _(E){return E&&E.length?this.write(E):""}var v=o("safe-buffer").Buffer,T=v.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=b,b.prototype.write=function(E){if(E.length===0)return"";var I,U;if(this.lastNeed){if(I=this.fillLast(E),I===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<E.length?I?I+this.text(E,U):this.text(E,U):I||""},b.prototype.end=function(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+"":I},b.prototype.text=function(E,I){var U=d(this,E,I);if(!this.lastNeed)return E.toString("utf8",I);this.lastTotal=U;var k=E.length-(U-this.lastNeed);return E.copy(this.lastChar,0,k),E.toString("utf8",I,k)},b.prototype.fillLast=function(E){return this.lastNeed<=E.length?(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),void(this.lastNeed-=E.length))}},{"safe-buffer":30}],32:[function(o,h){(function(c){(function(){function l(p){try{if(!c.localStorage)return!1}catch{return!1}var b=c.localStorage[p];return b!=null&&(b+"").toLowerCase()==="true"}h.exports=function(p,b){function u(){if(!d){if(l("throwDeprecation"))throw new Error(b);l("traceDeprecation")?console.trace(b):console.warn(b),d=!0}return p.apply(this,arguments)}if(l("noDeprecation"))return p;var d=!1;return u}}).call(this)}).call(this,typeof Tt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Tt)},{}],"/":[function(o,h){function c(N){return N.replace(/a=ice-options:trickle\s\n/g,"")}function l(N){console.warn(N)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const p=o("debug")("simple-peer"),b=o("get-browser-rtc"),u=o("randombytes"),d=o("readable-stream"),y=o("queue-microtask"),g=o("err-code"),{Buffer:C}=o("buffer"),M=65536;class L extends d.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=u(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||u(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||L.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},L.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:b(),!this._wrtc)throw g(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(g(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(g(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(g(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){const _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?l("Ignoring unsupported ICE candidate."):this.destroy(g(v,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(v){this.destroy(g(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const v=this._senderMap.get(m)||new Map;let T=v.get(_);if(!T)T=this._pc.addTrack(m,_),v.set(_,T),this._senderMap.set(m,v),this._needsNegotiation();else throw T.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,v){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const T=this._senderMap.get(m),E=T?T.get(v):null;if(!E)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,T),E.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):E.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const v=this._senderMap.get(m),T=v?v.get(_):null;if(!T)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{T.removed=!0,this._pc.removeTrack(T)}catch(E){E.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(T):this.destroy(g(E,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,y(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),y(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=M),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{const T=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(g(T,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,v){if(this.destroyed)return v(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(T){return this.destroy(g(T,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>M?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=m,this._cb=v}_onFinish(){if(!this.destroyed){const m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(g(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(g(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(g(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(g(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){const _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(T=>{Object.assign(v,T)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{const T=[];v.forEach(E=>{T.push(_(E))}),m(null,T)},v=>m(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;const T=[];v.result().forEach(E=>{const I={};E.names().forEach(U=>{I[U]=E.stat(U)}),I.id=E.id,I.type=E.type,I.timestamp=E.timestamp,T.push(_(I))}),m(null,T)},v=>m(v)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const m=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);const T={},E={},I={};let U=!1;v.forEach(A=>{(A.type==="remotecandidate"||A.type==="remote-candidate")&&(T[A.id]=A),(A.type==="localcandidate"||A.type==="local-candidate")&&(E[A.id]=A),(A.type==="candidatepair"||A.type==="candidate-pair")&&(I[A.id]=A)});const k=A=>{U=!0;let F=E[A.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof A.googLocalAddress=="string"&&(F=A.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=T[A.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof A.googRemoteAddress=="string"&&(j=A.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(A=>{A.type==="transport"&&A.selectedCandidatePairId&&k(I[A.selectedCandidatePairId]),(A.type==="googCandidatePair"&&A.googActiveConnection==="true"||(A.type==="candidatepair"||A.type==="candidate-pair")&&A.selected)&&k(A)}),!U&&(!Object.keys(I).length||Object.keys(E).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(g(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const A=this._cb;this._cb=null,A(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>M)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=C.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),y(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],p.apply(null,m)}}L.WEBRTC_SUPPORT=!!b(),L.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},L.channelConfig={},h.exports=L},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(Qs);var rl=Qs.exports;const sl=nl(rl),fr=0,dr=1,ti=2,ei=(n,t)=>{q(n,fr);const e=Wo(t);rt(n,e)},ni=(n,t,e)=>{q(n,dr),rt(n,jo(t,e))},il=(n,t,e)=>ni(t,e,lt(n)),ri=(n,t,e)=>{try{Uo(t,lt(n),e)}catch(s){console.error("Caught error while handling a Yjs update",s)}},ol=(n,t)=>{q(n,ti),rt(n,t)},al=ri,ll=(n,t,e,s)=>{const i=Y(n);switch(i){case fr:il(n,t,e);break;case dr:ri(n,e,s);break;case ti:al(n,e,s);break;default:throw new Error("Unknown message type")}return i},Ln=3e4;class cl extends Yr{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const e=Pt();this.getLocalState()!==null&&Ln/2<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const s=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Ln<=e-i.lastUpdated&&this.states.has(o)&&s.push(o)}),s.length>0&&Wn(this,s,"timeout")},It(Ln/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,s=this.meta.get(e),i=s===void 0?0:s.clock+1,o=this.states.get(e);t===null?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:i,lastUpdated:Pt()});const h=[],c=[],l=[],p=[];t===null?p.push(e):o==null?t!=null&&h.push(e):(c.push(e),Oe(o,t)||l.push(e)),(h.length>0||l.length>0||p.length>0)&&this.emit("change",[{added:h,updated:l,removed:p},"local"]),this.emit("update",[{added:h,updated:c,removed:p},"local"])}setLocalStateField(t,e){const s=this.getLocalState();s!==null&&this.setLocalState({...s,[t]:e})}getStates(){return this.states}}const Wn=(n,t,e)=>{const s=[];for(let i=0;i<t.length;i++){const o=t[i];if(n.states.has(o)){if(n.states.delete(o),o===n.clientID){const h=n.meta.get(o);n.meta.set(o,{clock:h.clock+1,lastUpdated:Pt()})}s.push(o)}}s.length>0&&(n.emit("change",[{added:[],updated:[],removed:s},e]),n.emit("update",[{added:[],updated:[],removed:s},e]))},hn=(n,t,e=n.states)=>{const s=t.length,i=ct();q(i,s);for(let o=0;o<s;o++){const h=t[o],c=e.get(h)||null,l=n.meta.get(h).clock;q(i,h),q(i,l),At(i,JSON.stringify(c))}return et(i)},hl=(n,t,e)=>{const s=Nt(t),i=Pt(),o=[],h=[],c=[],l=[],p=Y(s);for(let b=0;b<p;b++){const u=Y(s);let d=Y(s);const y=JSON.parse(Bt(s)),g=n.meta.get(u),C=n.states.get(u),M=g===void 0?0:g.clock;(M<d||M===d&&y===null&&n.states.has(u))&&(y===null?u===n.clientID&&n.getLocalState()!=null?d++:n.states.delete(u):n.states.set(u,y),n.meta.set(u,{clock:d,lastUpdated:i}),g===void 0&&y!==null?o.push(u):g!==void 0&&y===null?l.push(u):y!==null&&(Oe(y,C)||c.push(u),h.push(u)))}(o.length>0||c.length>0||l.length>0)&&n.emit("change",[{added:o,updated:c,removed:l},e]),(o.length>0||h.length>0||l.length>0)&&n.emit("update",[{added:o,updated:h,removed:l},e])},ul=(n,t)=>{const e=Un(n).buffer,s=Un(t).buffer;return crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},si=(n,t)=>{if(!t)return Kn(n);const e=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:e},t,n).then(s=>{const i=ct();return At(i,"AES-GCM"),rt(i,e),rt(i,new Uint8Array(s)),et(i)})},fl=(n,t)=>{const e=ct();return we(e,n),si(et(e),t)},ii=(n,t)=>{if(!t)return Kn(n);const e=Nt(n);Bt(e)!=="AES-GCM"&&$i(Lt("Unknown encryption algorithm"));const i=lt(e),o=lt(e);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,o).then(h=>new Uint8Array(h))},dl=(n,t)=>ii(n,t).then(e=>be(Nt(new Uint8Array(e)))),yt=Eo("y-webrtc"),me=0,oi=3,Pe=1,gr=4,un=new Map,ne=new Map,ai=n=>{let t=!0;n.webrtcConns.forEach(e=>{e.synced||(t=!1)}),(!t&&n.synced||t&&!n.synced)&&(n.synced=t,n.provider.emit("synced",[{synced:t}]),yt("synced ",vt,n.name,se," with all peers"))},li=(n,t,e)=>{const s=Nt(t),i=ct(),o=Y(s);if(n===void 0)return null;const h=n.awareness,c=n.doc;let l=!1;switch(o){case me:{q(i,me);const p=ll(s,i,c,n);p===dr&&!n.synced&&e(),p===fr&&(l=!0);break}case oi:q(i,Pe),rt(i,hn(h,Array.from(h.getStates().keys()))),l=!0;break;case Pe:hl(h,lt(s),n);break;case gr:{const p=re(s)===1,b=Bt(s);if(b!==n.peerId&&(n.bcConns.has(b)&&!p||!n.bcConns.has(b)&&p)){const u=[],d=[];p?(n.bcConns.add(b),d.push(b)):(n.bcConns.delete(b),u.push(b)),n.provider.emit("peers",[{added:d,removed:u,webrtcPeers:Array.from(n.webrtcConns.keys()),bcPeers:Array.from(n.bcConns)}]),ci(n)}break}default:return console.error("Unable to compute message"),i}return l?i:null},gl=(n,t)=>{const e=n.room;return yt("received message from ",vt,n.remotePeerId,Qn," (",e.name,")",se,yn),li(e,t,()=>{n.synced=!0,yt("synced ",vt,e.name,se," with ",vt,n.remotePeerId),ai(e)})},On=(n,t)=>{yt("send message to ",vt,n.remotePeerId,se,Qn," (",n.room.name,")",yn);try{n.peer.send(et(t))}catch{}},pl=(n,t)=>{yt("broadcast message in ",vt,n.name,se),n.webrtcConns.forEach(e=>{try{e.peer.send(t)}catch{}})};class qr{constructor(t,e,s,i){yt("establishing connection to ",vt,s),this.room=i,this.remotePeerId=s,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new sl({initiator:e,...i.provider.peerOpts}),this.peer.on("signal",o=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),pr(t,i,{to:s,from:i.peerId,type:"signal",token:this.glareToken,signal:o})}),this.peer.on("connect",()=>{yt("connected to ",vt,s),this.connected=!0;const h=i.provider.doc,c=i.awareness,l=ct();q(l,me),ei(l,h),On(this,l);const p=c.getStates();if(p.size>0){const b=ct();q(b,Pe),rt(b,hn(c,Array.from(p.keys()))),On(this,b)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),ai(i),this.peer.destroy(),yt("closed connection to ",vt,s),Hn(i)}),this.peer.on("error",o=>{yt("Error in connection to ",vt,s,": ",o),Hn(i)}),this.peer.on("data",o=>{const h=gl(this,o);h!==null&&On(this,h)})}destroy(){this.peer.destroy()}}const zt=(n,t)=>si(t,n.key).then(e=>n.mux(()=>tl(n.name,e))),Wr=(n,t)=>{n.bcconnected&&zt(n,t),pl(n,t)},Hn=n=>{un.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[n.name]}),n.webrtcConns.size<n.provider.maxConns&&pr(t,n,{type:"announce",from:n.peerId}))})},ci=n=>{if(n.provider.filterBcConns){const t=ct();q(t,gr),Ne(t,1),At(t,n.peerId),zt(n,et(t))}};class yl{constructor(t,e,s,i){this.peerId=Xr(),this.doc=t,this.awareness=e.awareness,this.provider=e,this.synced=!1,this.name=s,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=el(),this.bcconnected=!1,this._bcSubscriber=o=>ii(new Uint8Array(o),i).then(h=>this.mux(()=>{const c=li(this,h,()=>{});c&&zt(this,et(c))})),this._docUpdateHandler=(o,h)=>{const c=ct();q(c,me),ol(c,o),Wr(this,et(c))},this._awarenessUpdateHandler=({added:o,updated:h,removed:c},l)=>{const p=o.concat(h).concat(c),b=ct();q(b,Pe),rt(b,hn(this.awareness,p)),Wr(this,et(b))},this._beforeUnloadHandler=()=>{Wn(this.awareness,[t.clientID],"window unload"),ne.forEach(o=>{o.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Hn(this);const t=this.name;Za(t,this._bcSubscriber),this.bcconnected=!0,ci(this);const e=ct();q(e,me),ei(e,this.doc),zt(this,et(e));const s=ct();q(s,me),ni(s,this.doc),zt(this,et(s));const i=ct();q(i,oi),zt(this,et(i));const o=ct();q(o,Pe),rt(o,hn(this.awareness,[this.doc.clientID])),zt(this,et(o))}disconnect(){un.forEach(e=>{e.connected&&e.send({type:"unsubscribe",topics:[this.name]})}),Wn(this.awareness,[this.doc.clientID],"disconnect");const t=ct();q(t,gr),Ne(t,0),At(t,this.peerId),zt(this,et(t)),Qa(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(e=>e.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const ml=(n,t,e,s)=>{if(ne.has(e))throw Lt(`A Yjs Doc connected to room "${e}" already exists!`);const i=new yl(n,t,e,s);return ne.set(e,i),i},pr=(n,t,e)=>{t.key?fl(e,t.key).then(s=>{n.send({type:"publish",topic:t.name,data:as(s)})}):n.send({type:"publish",topic:t.name,data:e})};class wl extends Ja{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{yt(`connected (${t})`);const e=Array.from(ne.keys());this.send({type:"subscribe",topics:e}),ne.forEach(s=>pr(this,s,{type:"announce",from:s.peerId}))}),this.on("message",e=>{switch(e.type){case"publish":{const s=e.topic,i=ne.get(s);if(i==null||typeof s!="string")return;const o=h=>{const c=i.webrtcConns,l=i.peerId;if(h==null||h.from===l||h.to!==void 0&&h.to!==l||i.bcConns.has(h.from))return;const p=c.has(h.from)?()=>{}:()=>i.provider.emit("peers",[{removed:[],added:[h.from],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}]);switch(h.type){case"announce":c.size<i.provider.maxConns&&(wt(c,h.from,()=>new qr(this,!0,h.from,i)),p());break;case"signal":if(h.signal.type==="offer"){const b=c.get(h.from);if(b){const u=h.token,d=b.glareToken;if(d&&d>u){yt("offer rejected: ",h.from);return}b.glareToken=void 0}}if(h.signal.type==="answer"){yt("offer answered by: ",h.from);const b=c.get(h.from);b.glareToken=void 0}h.to===l&&(wt(c,h.from,()=>new qr(this,!1,h.from,i)).peer.signal(h.signal),p());break}};i.key?typeof e.data=="string"&&dl(ls(e.data),i.key).then(o):o(e.data)}}}),this.on("disconnect",()=>yt(`disconnect (${t})`))}}const xn=n=>{n.emit("status",[{connected:n.connected}])};class bl extends Hr{constructor(t,e,{signaling:s=["wss://y-webrtc-eu.fly.dev"],password:i=null,awareness:o=new cl(e),maxConns:h=20+It(Hi()*15),filterBcConns:c=!0,peerOpts:l={}}={}){super(),this.roomName=t,this.doc=e,this.filterBcConns=c,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=s,this.signalingConns=[],this.maxConns=h,this.peerOpts=l,this.key=i?ul(i,t):Kn(null),this.room=null,this.key.then(p=>{this.room=ml(e,this,t,p),this.shouldConnect?this.room.connect():this.room.disconnect(),xn(this)}),this.connect(),this.destroy=this.destroy.bind(this),e.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const e=wt(un,t,()=>new wl(t));this.signalingConns.push(e),e.providers.add(this)}),this.room&&(this.room.connect(),xn(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),un.delete(t.url))}),this.room&&(this.room.disconnect(),xn(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ne.delete(this.roomName)}),super.destroy()}}class _l{constructor(t,e){this.statusCallbacks=new Set,this.yDoc=t,this.config={roomName:e.roomName,signalingServers:e.signalingServers??["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],iceServers:e.iceServers??[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478"}]},this.provider=new bl(this.config.roomName,this.yDoc,{signaling:this.config.signalingServers,peerOpts:{config:{iceServers:this.config.iceServers}}}),this.setupEventListeners()}setupEventListeners(){this.provider.on("peers",t=>{const e={isConnected:t.webrtcPeers.length>0,peersCount:t.webrtcPeers.length};this.notifyStatusChange(e)}),this.provider.on("synced",t=>{console.log("Yjs synced:",t.synced)})}onStatusChange(t){this.statusCallbacks.add(t)}offStatusChange(t){this.statusCallbacks.delete(t)}notifyStatusChange(t){this.statusCallbacks.forEach(e=>e(t))}getConnectionStatus(){var e;const t=((e=this.provider.room)==null?void 0:e.webrtcConns.size)??0;return{isConnected:t>0,peersCount:t}}getRoomName(){return this.config.roomName}destroy(){this.provider.destroy(),this.statusCallbacks.clear()}}class vl{constructor(){this.yDoc=new Re;const t=new URLSearchParams(window.location.search),e=t.get("room")??this.generateRoomId();t.get("room")||window.history.replaceState({},"",`?room=${e}`),this.webrtcProvider=new _l(this.yDoc,{roomName:e}),this.deck=new Ya({initialCardCount:60});const s=document.getElementById("whiteboard");if(!s)throw new Error("Whiteboard container not found");this.whiteboard=new $a(s,this.yDoc),this.setupUI(),this.setupConnectionStatus()}generateRoomId(){return`mtg-${Math.random().toString(36).substring(2,9)}`}setupUI(){const t=document.getElementById("draw-card"),e=document.getElementById("shuffle-deck");document.getElementById("deck-count"),t&&t.addEventListener("click",()=>{const s=this.deck.drawCard();s&&(s.x=window.innerWidth/2-31.5,s.y=window.innerHeight/2-44,this.whiteboard.addCard(s),this.updateDeckCount())}),e&&e.addEventListener("click",()=>{this.deck.shuffleDeck(),console.log("Deck shuffled")}),this.updateDeckCount()}updateDeckCount(){const t=document.getElementById("deck-count");t&&(t.textContent=`Cards in deck: ${this.deck.getCardCount()}`)}setupConnectionStatus(){const t=document.getElementById("connection-status"),e=document.getElementById("room-name");e&&(e.textContent=`Room: ${this.webrtcProvider.getRoomName()}`),this.webrtcProvider.onStatusChange(s=>{t&&(s.isConnected?(t.textContent=`Connected (${s.peersCount} peer${s.peersCount!==1?"s":""})`,t.style.color="#4ade80"):(t.textContent="Waiting for peers...",t.style.color="#facc15"))})}destroy(){this.whiteboard.destroy(),this.webrtcProvider.destroy()}}const Cl=new vl;window.addEventListener("beforeunload",()=>{Cl.destroy()});
//# sourceMappingURL=index-BGPVkOtq.js.map
